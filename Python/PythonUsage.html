<!DOCTYPE html>
  <html>
    <head>
      <title>PythonUsage</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.9.0/katex.min.css">
      
      
      
      
      
      
      
      
      
      

      <style> 
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
.markdown-preview.markdown-preview code.red {
  background-color: #f8f2f4;
  color: #d40a32;
}
.markdown-preview.markdown-preview code.green {
  background-color: #eafef1;
  color: #089308;
}
.markdown-preview.markdown-preview #maste_title {
  color: #00bfff;
  font-size: 50px;
  font-family: 'Courier New', Courier, monospace;
}
.markdown-preview.markdown-preview .vice_title {
  color: #d0a3d0;
  font-size: 25px;
  font-family: 'Courier New', Courier, monospace;
}
.markdown-preview.markdown-preview hr.title_separator {
  border: 0;
  height: 0;
  /* Firefox... */
  box-shadow: 0 0 10px 1px deepskyblue;
}
 
      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview   ">
      <p><image src="../assets/logo_min.png" style="width:50px"> <span id="maste_title">foolish fly fox's blog<span></span></span></image></p>
<p><span class="vice_title">--Stay hungry, stay foolish.<span><br>
<span class="vice_title">--Forever young, forever weep.<span></span></span></span></span></p>
<hr class="title_separator">
<br>
<h1 class="mume-header" id="python-%E4%BD%BF%E7%94%A8">Python 使用</h1>

<h2 class="mume-header" id="%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95">数据结构与算法</h2>

<h3 class="mume-header" id="%E5%8E%8B%E7%BC%A9%E5%BA%8F%E5%88%97%E7%9A%84%E8%B5%8B%E5%80%BC">压缩序列的赋值</h3>

<p>压缩序列可以是如何可迭代对象。</p>
<div class="code-chunk" data-id="code-chunk-id-0" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"1:"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span>
a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c <span class="token operator">=</span> <span class="token string">"xyz"</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"2:"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span>
a<span class="token punctuation">,</span><span class="token operator">*</span>b<span class="token punctuation">,</span>c <span class="token operator">=</span> <span class="token string">"1234567"</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"3:"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 带*的解压出来都是list类型</span>
a<span class="token punctuation">,</span><span class="token operator">*</span>b<span class="token punctuation">,</span>c<span class="token operator">=</span><span class="token string">"13"</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"4:"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">f1</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token operator">*</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"5:"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
f1<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">f2</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"6:"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
f2<span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="collectionscounter">collections.Counter</h3>

<p>该类用于计算序列中出现次数最多的元素。</p>
<div class="code-chunk" data-id="code-chunk-id-1" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">from</span> collections <span class="token keyword">import</span> Counter
words <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'look'</span><span class="token punctuation">,</span> <span class="token string">'into'</span><span class="token punctuation">,</span> <span class="token string">'my'</span><span class="token punctuation">,</span> <span class="token string">'eyes'</span><span class="token punctuation">,</span> <span class="token string">'look'</span><span class="token punctuation">,</span> <span class="token string">'into'</span><span class="token punctuation">,</span> <span class="token string">'my'</span><span class="token punctuation">,</span> <span class="token string">'eyes'</span><span class="token punctuation">,</span>
    <span class="token string">'the'</span><span class="token punctuation">,</span> <span class="token string">'eyes'</span><span class="token punctuation">,</span> <span class="token string">'the'</span><span class="token punctuation">,</span> <span class="token string">'eyes'</span><span class="token punctuation">,</span> <span class="token string">'the'</span><span class="token punctuation">,</span> <span class="token string">'eyes'</span><span class="token punctuation">,</span> <span class="token string">'not'</span><span class="token punctuation">,</span> <span class="token string">'around'</span><span class="token punctuation">,</span> <span class="token string">'the'</span><span class="token punctuation">,</span>
    <span class="token string">'eyes'</span><span class="token punctuation">,</span> <span class="token string">"don't"</span><span class="token punctuation">,</span> <span class="token string">'look'</span><span class="token punctuation">,</span> <span class="token string">'around'</span><span class="token punctuation">,</span> <span class="token string">'the'</span><span class="token punctuation">,</span> <span class="token string">'eyes'</span><span class="token punctuation">,</span> <span class="token string">'look'</span><span class="token punctuation">,</span> <span class="token string">'into'</span><span class="token punctuation">,</span>
    <span class="token string">'my'</span><span class="token punctuation">,</span> <span class="token string">'eyes'</span><span class="token punctuation">,</span> <span class="token string">"you're"</span><span class="token punctuation">,</span> <span class="token string">'under'</span>
<span class="token punctuation">]</span>
word_counts <span class="token operator">=</span> Counter<span class="token punctuation">(</span>words<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>word_counts<span class="token punctuation">.</span>most_common<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>word_counts<span class="token punctuation">[</span><span class="token string">'into'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
word_counts<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'into'</span><span class="token punctuation">,</span><span class="token string">'into'</span><span class="token punctuation">,</span><span class="token string">'eyes'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>word_counts<span class="token punctuation">.</span>most_common<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p><code>Counter</code>对象可以接受任意的由可哈希(hashable)元素构成的序列对象。</p>
<p><code>Counter</code> 对象可以继续加减运算：</p>
<div class="code-chunk" data-id="code-chunk-id-2" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">from</span> collections <span class="token keyword">import</span> Counter
words1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'in'</span><span class="token punctuation">,</span> <span class="token string">'the'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'an'</span><span class="token punctuation">,</span> <span class="token string">'in'</span><span class="token punctuation">,</span> <span class="token string">'the'</span><span class="token punctuation">,</span> <span class="token string">'the'</span><span class="token punctuation">]</span>
words2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'the'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'with'</span><span class="token punctuation">,</span> <span class="token string">'in'</span><span class="token punctuation">]</span>
a <span class="token operator">=</span> Counter<span class="token punctuation">(</span>words1<span class="token punctuation">)</span>
b <span class="token operator">=</span> Counter<span class="token punctuation">(</span>words2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">+</span>b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">-</span>b<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E9%80%9A%E8%BF%87%E6%9F%90%E4%B8%AA%E5%85%B3%E9%94%AE%E5%AD%97%E6%8E%92%E5%BA%8F%E5%AD%97%E5%85%B8%E5%88%97%E8%A1%A8">通过某个关键字排序字典列表</h3>

<div class="code-chunk" data-id="code-chunk-id-3" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">rows <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token string">'fname'</span><span class="token punctuation">:</span> <span class="token string">'Brian'</span><span class="token punctuation">,</span> <span class="token string">'lname'</span><span class="token punctuation">:</span> <span class="token string">'Jones'</span><span class="token punctuation">,</span> <span class="token string">'uid'</span><span class="token punctuation">:</span> <span class="token number">1003</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'fname'</span><span class="token punctuation">:</span> <span class="token string">'David'</span><span class="token punctuation">,</span> <span class="token string">'lname'</span><span class="token punctuation">:</span> <span class="token string">'Beazley'</span><span class="token punctuation">,</span> <span class="token string">'uid'</span><span class="token punctuation">:</span> <span class="token number">1005</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'fname'</span><span class="token punctuation">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span> <span class="token string">'lname'</span><span class="token punctuation">:</span> <span class="token string">'Cleese'</span><span class="token punctuation">,</span> <span class="token string">'uid'</span><span class="token punctuation">:</span> <span class="token number">1001</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'fname'</span><span class="token punctuation">:</span> <span class="token string">'Big'</span><span class="token punctuation">,</span> <span class="token string">'lname'</span><span class="token punctuation">:</span> <span class="token string">'Jones'</span><span class="token punctuation">,</span> <span class="token string">'uid'</span><span class="token punctuation">:</span> <span class="token number">1004</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"---sort by fname---"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> sorted<span class="token punctuation">(</span>rows<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> r<span class="token punctuation">:</span>r<span class="token punctuation">[</span><span class="token string">'fname'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n---sort by uid (reverse)---"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> sorted<span class="token punctuation">(</span>rows<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> r<span class="token punctuation">:</span>r<span class="token punctuation">[</span><span class="token string">'uid'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n---sort by multi-keywords(1)---"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> sorted<span class="token punctuation">(</span>rows<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> r<span class="token punctuation">:</span><span class="token punctuation">(</span>r<span class="token punctuation">[</span><span class="token string">'lname'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>r<span class="token punctuation">[</span><span class="token string">'fname'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 使用 itemgetter 速率会稍稍快点</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n---sort by multi-keywords(2)---"</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> operator <span class="token keyword">import</span> itemgetter
<span class="token keyword">for</span> i <span class="token keyword">in</span> sorted<span class="token punctuation">(</span>rows<span class="token punctuation">,</span> key<span class="token operator">=</span>itemgetter<span class="token punctuation">(</span><span class="token string">'lname'</span><span class="token punctuation">,</span><span class="token string">'fname'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># max / min</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n---max / min---"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>max<span class="token punctuation">(</span>rows<span class="token punctuation">,</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> r<span class="token punctuation">:</span>r<span class="token punctuation">[</span><span class="token string">'uid'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>min<span class="token punctuation">(</span>rows<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> r<span class="token punctuation">:</span>r<span class="token punctuation">[</span><span class="token string">'fname'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E6%8E%92%E5%BA%8F%E6%AF%94%E6%94%AF%E6%8C%81%E5%8E%9F%E7%94%9F%E6%AF%94%E8%BE%83%E7%9A%84%E5%AF%B9%E8%B1%A1">排序比支持原生比较的对象</h3>

<div class="code-chunk" data-id="code-chunk-id-4" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> user_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>user_id <span class="token operator">=</span> user_id
    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> f<span class="token string">"User ({self.user_id})"</span>
users <span class="token operator">=</span> <span class="token punctuation">[</span>User<span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">,</span> User<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> User<span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sorted<span class="token punctuation">(</span>users<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> u<span class="token punctuation">:</span>u<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> operator <span class="token keyword">import</span> attrgetter
<span class="token keyword">print</span><span class="token punctuation">(</span>sorted<span class="token punctuation">(</span>users<span class="token punctuation">,</span> key<span class="token operator">=</span>attrgetter<span class="token punctuation">(</span><span class="token string">'user_id'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E9%80%9A%E8%BF%87%E6%9F%90%E4%B8%AA%E5%AD%97%E6%AE%B5%E5%B0%86%E8%AE%B0%E5%BD%95%E5%88%86%E7%BB%84">通过某个字段将记录分组</h3>

<div class="code-chunk" data-id="code-chunk-id-5" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">from</span> itertools <span class="token keyword">import</span> groupby
<span class="token keyword">from</span> operator <span class="token keyword">import</span> itemgetter
rows <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token string">'address'</span><span class="token punctuation">:</span> <span class="token string">'5412 N CLARK'</span><span class="token punctuation">,</span> <span class="token string">'date'</span><span class="token punctuation">:</span> <span class="token string">'07/01/2012'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'address'</span><span class="token punctuation">:</span> <span class="token string">'5148 N CLARK'</span><span class="token punctuation">,</span> <span class="token string">'date'</span><span class="token punctuation">:</span> <span class="token string">'07/04/2012'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'address'</span><span class="token punctuation">:</span> <span class="token string">'5800 E 58TH'</span><span class="token punctuation">,</span> <span class="token string">'date'</span><span class="token punctuation">:</span> <span class="token string">'07/02/2012'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'address'</span><span class="token punctuation">:</span> <span class="token string">'2122 N CLARK'</span><span class="token punctuation">,</span> <span class="token string">'date'</span><span class="token punctuation">:</span> <span class="token string">'07/03/2012'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'address'</span><span class="token punctuation">:</span> <span class="token string">'5645 N RAVENSWOOD'</span><span class="token punctuation">,</span> <span class="token string">'date'</span><span class="token punctuation">:</span> <span class="token string">'07/02/2012'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'address'</span><span class="token punctuation">:</span> <span class="token string">'1060 W ADDISON'</span><span class="token punctuation">,</span> <span class="token string">'date'</span><span class="token punctuation">:</span> <span class="token string">'07/02/2012'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'address'</span><span class="token punctuation">:</span> <span class="token string">'4801 N BROADWAY'</span><span class="token punctuation">,</span> <span class="token string">'date'</span><span class="token punctuation">:</span> <span class="token string">'07/01/2012'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'address'</span><span class="token punctuation">:</span> <span class="token string">'1039 W GRANVILLE'</span><span class="token punctuation">,</span> <span class="token string">'date'</span><span class="token punctuation">:</span> <span class="token string">'07/04/2012'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># groupby 之前需要先排序</span>
rows<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span>itemgetter<span class="token punctuation">(</span><span class="token string">'date'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> date<span class="token punctuation">,</span> items <span class="token keyword">in</span> groupby<span class="token punctuation">(</span>rows<span class="token punctuation">,</span> key<span class="token operator">=</span>itemgetter<span class="token punctuation">(</span><span class="token string">'date'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>date<span class="token punctuation">,</span> <span class="token string">":"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> item <span class="token keyword">in</span> items<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"   "</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p><strong>注意：一个非常重要的准备步骤是在<code>groupby</code>之前进行数据排序，因为<code>groupby</code>仅仅检查连续的元素。</strong></p>
<h3 class="mume-header" id="%E8%BF%87%E6%BB%A4%E5%BA%8F%E5%88%97%E5%85%83%E7%B4%A0">过滤序列元素</h3>

<div class="code-chunk" data-id="code-chunk-id-6" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">mylist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 求出大于0的元素</span>
<span class="token comment" spellcheck="true"># 列表推导：缺点--输出非常大时需要产生一个大结果集，占内存</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> mylist <span class="token keyword">if</span> i<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 生成器</span>
g <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> mylist <span class="token keyword">if</span> i<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> g<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">" "</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 将负数变为正数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>i <span class="token keyword">if</span> i<span class="token operator">></span><span class="token number">0</span> <span class="token keyword">else</span> <span class="token operator">-</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> mylist<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 对于复杂情况 用filter，返回迭代器</span>
values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">,</span><span class="token string">'-3'</span><span class="token punctuation">,</span><span class="token string">'-'</span><span class="token punctuation">,</span><span class="token string">'4'</span><span class="token punctuation">,</span><span class="token string">'N/A'</span><span class="token punctuation">,</span><span class="token string">'5'</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">is_int</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        int<span class="token punctuation">(</span>val<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>filter<span class="token punctuation">(</span>is_int<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 输出指定位置的数据 compress返回迭代器</span>
<span class="token keyword">from</span> itertools <span class="token keyword">import</span> compress
output_e <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">]</span><span class="token operator">*</span>len<span class="token punctuation">(</span>mylist<span class="token punctuation">)</span>
output_e<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>output_e<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span>output_e<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token boolean">False</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>compress<span class="token punctuation">(</span>mylist<span class="token punctuation">,</span> output_e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E5%AD%97%E5%85%B8%E7%9A%84%E6%9C%80%E5%A4%A7%E5%80%BC%E6%9C%80%E5%B0%8F%E5%80%BC%E6%8E%92%E5%BA%8F">字典的最大值/最小值/排序</h3>

<div class="code-chunk" data-id="code-chunk-id-7" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">prices <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'ACME'</span><span class="token punctuation">:</span><span class="token number">45.23</span><span class="token punctuation">,</span>
    <span class="token string">'AAPL'</span><span class="token punctuation">:</span><span class="token number">612.78</span><span class="token punctuation">,</span>
    <span class="token string">'IBM'</span><span class="token punctuation">:</span><span class="token number">205.55</span><span class="token punctuation">,</span>
    <span class="token string">'HPQ'</span><span class="token punctuation">:</span><span class="token number">37.20</span><span class="token punctuation">,</span>
    <span class="token string">'FB'</span><span class="token punctuation">:</span><span class="token number">10.75</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true"># 求键值最小/最大的键名</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"1 : {min(prices)}"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"2 : {max(prices)}"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"3 : {sorted(prices)}"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 求值最小/最大的键名</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"4-1 : {min(zip(prices.values(), prices.keys()))[-1]}"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># lambda 后面跟的s是通过 in 可取的迭代器中的值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"4-2 : {min(prices, key=lambda s:prices[s])}"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"5-1 : {max(zip(prices.values(), prices.keys()))[-1]}"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"5-2 : {max(prices, key=lambda s:prices[s])}"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"6 : {[i[-1] for i in sorted(zip(prices.values(), prices.keys()))]}"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 当值存在重复时 max的结果为key较大的</span>
prices <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'AAA'</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'ZZZ'</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'BBB'</span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"7 : {max(zip(prices.values(), prices.keys()))[-1]}"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 寻找两个字典系统的键</span>
a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'x'</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">}</span>
b <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'w'</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span>
<span class="token comment" spellcheck="true"># 集合求交操作</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"8-1 : {[i for i in a if i in b]}"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"8-2 : {a.keys() &amp; b.keys()}"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 集合求差操作</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"9-1 : {[i for i in a if i not in b]}"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"9-2 : {a.keys() - b.keys()}"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 集合求异操作</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"10 : {a.keys()^b.keys()}"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 集合并操作</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"11 : {a.keys()|b.keys()}"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 寻找两字典键值对相等的item</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"12-1 : {[(i,a[i]) for i in a if i in b and a[i]==b[i] ]}"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"12-2 : {a.items() &amp; b.items()}"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 输出指定键名的item</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"13-1 : { {i:a[i] for i in a.keys()-{'x'}} }"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"13-2 : { {i:a[i] for i in a if i not in ['x']} }"</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>注：<code>zip()</code>函数创建的是一个只能访问一次的迭代器！</p>
<p>字典的<code>keys()</code>方法返回一个展现键集合的键视图对象，其支持集合操作：并(<code>|</code>)、交(<code>&amp;</code>)、差(<code>-</code>)、求异(<code>^</code>)。这4中操作对 <code>set</code> 类型适用。如果想对集合的键执行一些普通的集合操作，可以直接使用键视图对象，而不用现将它们转换成一个<code>set</code>。</p>
<p>字典的<code>items()</code>也支持集合操作。但<code>values()</code>不支持集合操作。</p>
<h3 class="mume-header" id="%E4%BB%8E%E5%AD%97%E5%85%B8%E4%B8%AD%E6%8F%90%E5%8F%96%E5%AD%90%E9%9B%86">从字典中提取子集</h3>

<div class="code-chunk" data-id="code-chunk-id-8" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">prices <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'ACME'</span><span class="token punctuation">:</span> <span class="token number">45.23</span><span class="token punctuation">,</span>
    <span class="token string">'AAPL'</span><span class="token punctuation">:</span> <span class="token number">612.78</span><span class="token punctuation">,</span>
    <span class="token string">'IBM'</span><span class="token punctuation">:</span> <span class="token number">205.55</span><span class="token punctuation">,</span>
    <span class="token string">'HPQ'</span><span class="token punctuation">:</span> <span class="token number">37.20</span><span class="token punctuation">,</span>
    <span class="token string">'FB'</span><span class="token punctuation">:</span> <span class="token number">10.75</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true"># 获得值大于200的items</span>
<span class="token comment" spellcheck="true"># 使用字典推导</span>
p1 <span class="token operator">=</span> <span class="token punctuation">{</span>k<span class="token punctuation">:</span>v <span class="token keyword">for</span> k<span class="token punctuation">,</span>v <span class="token keyword">in</span> prices<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> v<span class="token operator">></span><span class="token number">200</span><span class="token punctuation">}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span>
tech_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"FB"</span><span class="token punctuation">,</span> <span class="token string">"IBM"</span><span class="token punctuation">,</span> <span class="token string">"ACME"</span><span class="token punctuation">]</span>
p2 <span class="token operator">=</span> <span class="token punctuation">{</span>k<span class="token punctuation">:</span>v <span class="token keyword">for</span> k<span class="token punctuation">,</span>v <span class="token keyword">in</span> prices<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> k <span class="token keyword">in</span> tech_names<span class="token punctuation">}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E5%AD%97%E5%85%B8%E5%90%88%E5%B9%B6">字典合并</h3>

<div class="code-chunk" data-id="code-chunk-id-9" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">from</span> collections <span class="token keyword">import</span> ChainMap
a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'x'</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span>
b <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'y'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">}</span>
c <span class="token operator">=</span> ChainMap<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ChinaMap result:"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token string">'y'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token string">'z'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>c<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>c<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># ChainMap 只是存储了一个视图而已</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nChainMap just store a view:"</span><span class="token punctuation">)</span>
a<span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>c<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
c<span class="token punctuation">[</span><span class="token string">'z'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">20</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\ndict.update demo:"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 也可使用update进行合并</span>
d <span class="token operator">=</span> dict<span class="token punctuation">(</span>b<span class="token punctuation">)</span>
d<span class="token punctuation">.</span>update<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># dict.update进行了拷贝而非视图</span>
d<span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">30</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E6%98%A0%E5%B0%84%E5%90%8D%E7%A7%B0%E5%88%B0%E5%BA%8F%E5%88%97%E5%85%83%E7%B4%A0-namedtuple">映射名称到序列元素 namedtuple</h3>

<div class="code-chunk" data-id="code-chunk-id-10" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">from</span> collections <span class="token keyword">import</span> namedtuple
Subscriber <span class="token operator">=</span> namedtuple<span class="token punctuation">(</span><span class="token string">'Subscriber'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'addr'</span><span class="token punctuation">,</span> <span class="token string">'joined'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
sub <span class="token operator">=</span> Subscriber<span class="token punctuation">(</span><span class="token string">'jonesy@example.com'</span><span class="token punctuation">,</span> <span class="token string">'2012-10-19'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sub<span class="token punctuation">.</span>addr<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sub<span class="token punctuation">.</span>joined<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 支持所有的普通元组操作</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>len<span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sub<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
addr<span class="token punctuation">,</span> joined <span class="token operator">=</span> sub
<span class="token keyword">print</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> joined<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p><strong>命名元组的一个主要用途是将你的代码从下表操作中解脱出来。</strong></p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token comment" spellcheck="true"># 普通元组</span>
<span class="token keyword">def</span> <span class="token function">compute_cost</span><span class="token punctuation">(</span>records<span class="token punctuation">)</span><span class="token punctuation">:</span>
    total <span class="token operator">=</span> <span class="token number">0.0</span>
    <span class="token keyword">for</span> rec <span class="token keyword">in</span> records<span class="token punctuation">:</span>
        total <span class="token operator">+=</span> rec<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">*</span>rec<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> total
<span class="token comment" spellcheck="true"># namedtuple</span>
<span class="token keyword">from</span> collections <span class="token keyword">import</span> namedtuple
Stock <span class="token operator">=</span> namedtuple<span class="token punctuation">(</span><span class="token string">'Stock'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'shares'</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">compute_cost</span><span class="token punctuation">(</span>records<span class="token punctuation">)</span><span class="token punctuation">:</span>
    total <span class="token operator">=</span> <span class="token number">0.0</span>
    <span class="token keyword">for</span> rec <span class="token keyword">in</span> records<span class="token punctuation">:</span>
        s <span class="token operator">=</span> Stock<span class="token punctuation">(</span><span class="token operator">*</span>rec<span class="token punctuation">)</span>
        total <span class="token operator">+=</span> s<span class="token punctuation">.</span>shares <span class="token operator">*</span> s<span class="token punctuation">.</span>price
    <span class="token keyword">return</span> total
</pre><p><strong>命名元组的另一个用途就是作为字典的替代，因为字典存储需要更多的内存空间。如果你需要构建一个非常大的包含字典的数据结构，那么使用命名元组会更加高效。但是：一个命名元组是不可更改的！</strong></p>
<p>如果真的需要改变属性的值，那么可以使用命名元组实例的 <code>_replace()</code>方法，它会创建一个全新的命名元组并将对应的字段用新的值取代：</p>
<div class="code-chunk" data-id="code-chunk-id-11" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">from</span> collections <span class="token keyword">import</span> namedtuple
Stock <span class="token operator">=</span> namedtuple<span class="token punctuation">(</span><span class="token string">'Stock'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'shares'</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
s <span class="token operator">=</span> Stock<span class="token punctuation">(</span><span class="token string">'ACME'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">73.5</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
s <span class="token operator">=</span> s<span class="token punctuation">.</span>_replace<span class="token punctuation">(</span>shares<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E8%BD%AC%E6%8D%A2%E5%B9%B6%E8%AE%A1%E7%AE%97%E6%95%B0%E6%8D%AE">转换并计算数据</h3>

<p>问题：你需要在数据序列上执行聚集函数，比如 <code>sum()</code>、<code>min()</code>、<code>max()</code>，但首先需要转换或过滤数据：</p>
<div class="code-chunk" data-id="code-chunk-id-12" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 求平方和</span>
s <span class="token operator">=</span> sum<span class="token punctuation">(</span>x<span class="token operator">**</span><span class="token number">2</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> nums<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>注意：在<code>for</code>中的语句执行1遍，其他的执行循环的次数：</p>
<div class="code-chunk" data-id="code-chunk-id-13" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"call f"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> x<span class="token operator">**</span><span class="token number">2</span>
a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"---test 1---"</span><span class="token punctuation">)</span>
sum<span class="token punctuation">(</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> range<span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n---test 2---"</span><span class="token punctuation">)</span>
sum<span class="token punctuation">(</span>f<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n---test 3---"</span><span class="token punctuation">)</span>
sum<span class="token punctuation">(</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> a <span class="token keyword">if</span> x <span class="token operator">&lt;</span> f<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>上面演示的是生成器表达式作为一个单独参数传递给函数时候的巧妙语法（并不需要多加一个括号），例如：</p>
<div class="code-chunk" data-id="code-chunk-id-14" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sum<span class="token punctuation">(</span>n <span class="token keyword">for</span> n <span class="token keyword">in</span> nums<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sum<span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token keyword">for</span> n <span class="token keyword">in</span> nums<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E5%88%A0%E9%99%A4%E5%BA%8F%E5%88%97%E7%B3%BB%E7%BB%9F%E5%85%83%E7%B4%A0%E5%B9%B6%E4%BF%9D%E6%8C%81%E9%A1%BA%E5%BA%8F">删除序列系统元素并保持顺序</h3>

<div class="code-chunk" data-id="code-chunk-id-15" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 会打乱顺序</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">":"</span><span class="token punctuation">,</span> list<span class="token punctuation">(</span>set<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">dedupe</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">:</span>
    seen <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> item <span class="token keyword">in</span> items<span class="token punctuation">:</span>
        <span class="token keyword">if</span> item <span class="token operator">not</span> <span class="token keyword">in</span> seen<span class="token punctuation">:</span>
            <span class="token keyword">yield</span> item
        seen<span class="token punctuation">.</span>add<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">":"</span><span class="token punctuation">,</span> list<span class="token punctuation">(</span>dedupe<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>上面的方法只在序列中元素为hashable的时候才管用。消除不可哈希（如<code>dict</code>类型）的序列中重复元素：</p>
<div class="code-chunk" data-id="code-chunk-id-16" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'x'</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'x'</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> 
<span class="token punctuation">{</span><span class="token string">'x'</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'x'</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">dedupe</span><span class="token punctuation">(</span>items<span class="token punctuation">,</span> key<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>
    seen <span class="token operator">=</span> set<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> item <span class="token keyword">in</span> items<span class="token punctuation">:</span>
        val <span class="token operator">=</span> item <span class="token keyword">if</span> key<span class="token operator">==</span>None <span class="token keyword">else</span> key<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
        <span class="token keyword">if</span> val <span class="token operator">not</span> <span class="token keyword">in</span> seen<span class="token punctuation">:</span>
            <span class="token keyword">yield</span> item
        seen<span class="token punctuation">.</span>add<span class="token punctuation">(</span>val<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>dedupe<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token keyword">lambda</span> s<span class="token punctuation">:</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>s<span class="token punctuation">[</span><span class="token string">'y'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span>dedupe<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token keyword">lambda</span> s<span class="token punctuation">:</span>s<span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E5%91%BD%E5%90%8D%E5%88%87%E7%89%87">命名切片</h3>

<p>将切片从硬切片中独立出来：</p>
<div class="code-chunk" data-id="code-chunk-id-17" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">record <span class="token operator">=</span> <span class="token string">'....................100 .......513.25 ..........'</span>
<span class="token comment" spellcheck="true"># 硬切片方式</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>int<span class="token punctuation">(</span>record<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token number">23</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span>float<span class="token punctuation">(</span>record<span class="token punctuation">[</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">37</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 命名切片方式</span>
SHARES <span class="token operator">=</span> slice<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span>
PRICE <span class="token operator">=</span> slice<span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">,</span><span class="token number">37</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>int<span class="token punctuation">(</span>record<span class="token punctuation">[</span>SHARES<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span>float<span class="token punctuation">(</span>record<span class="token punctuation">[</span>PRICE<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>命名切片的优点：<strong>一般来说，代码中如果出现大量的硬编码下标值，会使得可读性和可维护性大大降低，命名切片可以清晰地表达代码的逻辑。</strong></p>
<p><code>slice</code>的使用：</p>
<div class="code-chunk" data-id="code-chunk-id-18" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span>
a <span class="token operator">=</span> slice<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>start<span class="token punctuation">,</span> a<span class="token punctuation">.</span>stop<span class="token punctuation">,</span> a<span class="token punctuation">.</span>step<span class="token punctuation">)</span>
items<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="defaultdict-%E6%A8%A1%E5%9D%97">defaultdict 模块</h3>

<p>用于构建一个键对应多个值得字典（也称为 <strong>multidict</strong>）；</p>
<h4 class="mume-header" id="%E4%BD%BF%E7%94%A8-dict%E5%AE%B9%E5%99%A8">使用 dict+容器</h4>

<pre data-role="codeBlock" data-info="python" class="language-python">d <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'a'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'b'</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
e <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'a'</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'b'</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><h4 class="mume-header" id="%E4%BD%BF%E7%94%A8-collectionsdefaultdict">使用 collections.defaultdict</h4>

<div class="code-chunk" data-id="code-chunk-id-19" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict
d <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>list<span class="token punctuation">)</span>
d<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
d<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
d<span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>

e <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>set<span class="token punctuation">)</span>
e<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
e<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
e<span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h4 class="mume-header" id="%E8%87%AA%E5%8A%A8%E5%88%9B%E5%BB%BA%E9%94%AE">自动创建键</h4>

<p><code>defaultdict</code>会自动为将要访问的键（就算当前字典中并不存在这样的键）创建映射实体。如果你并不需要这样的特性，你可以在一个普通的字典上使用<code>setdefault()</code>方法替代：</p>
<div class="code-chunk" data-id="code-chunk-id-20" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">d <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
d<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
d<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
d<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>使用<code>defaultdict</code>:</p>
<div class="code-chunk" data-id="code-chunk-id-21" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">from</span> collections <span class="token keyword">import</span> defaultdict
d <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span>list<span class="token punctuation">)</span>
d<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
d<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
d<span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="heapq-%E6%A8%A1%E5%9D%97">heapq 模块</h3>

<h4 class="mume-header" id="%E8%8E%B7%E5%BE%97%E9%9B%86%E5%90%88%E4%B8%AD%E6%9C%80%E5%A4%A7%E6%9C%80%E5%B0%8F%E7%9A%84n%E6%AD%8C%E5%85%83%E7%B4%A0%E5%88%97%E8%A1%A8">获得集合中最大/最小的N歌元素列表</h4>

<div class="code-chunk" data-id="code-chunk-id-22" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">import</span> heapq
nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">,</span><span class="token number">41</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token number">75</span><span class="token punctuation">,</span><span class="token number">27</span><span class="token punctuation">,</span><span class="token number">94</span><span class="token punctuation">,</span><span class="token number">67</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>heapq<span class="token punctuation">.</span>nlargest<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> nums<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>heapq<span class="token punctuation">.</span>nsmallest<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> nums<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>两个函数都能接收一个关键字参数：</p>
<div class="code-chunk" data-id="code-chunk-id-23" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">import</span> heapq
portfolio <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'IBM'</span><span class="token punctuation">,</span> <span class="token string">'shares'</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">:</span> <span class="token number">91.1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'AAPL'</span><span class="token punctuation">,</span> <span class="token string">'shares'</span><span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">:</span> <span class="token number">543.22</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'FB'</span><span class="token punctuation">,</span> <span class="token string">'shares'</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">:</span> <span class="token number">21.09</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'HPQ'</span><span class="token punctuation">,</span> <span class="token string">'shares'</span><span class="token punctuation">:</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">:</span> <span class="token number">31.75</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'YHOO'</span><span class="token punctuation">,</span> <span class="token string">'shares'</span><span class="token punctuation">:</span> <span class="token number">45</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">:</span> <span class="token number">16.35</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'ACME'</span><span class="token punctuation">,</span> <span class="token string">'shares'</span><span class="token punctuation">:</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">:</span> <span class="token number">115.65</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>heapq<span class="token punctuation">.</span>nlargest<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> portfolio<span class="token punctuation">,</span> <span class="token keyword">lambda</span> s<span class="token punctuation">:</span>s<span class="token punctuation">[</span><span class="token string">'price'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>heapq<span class="token punctuation">.</span>nsmallest<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> portfolio<span class="token punctuation">,</span> <span class="token keyword">lambda</span> s<span class="token punctuation">:</span>s<span class="token punctuation">[</span><span class="token string">'price'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h4 class="mume-header" id="%E5%A0%86%E6%8E%92%E5%BA%8F">堆排序</h4>

<div class="code-chunk" data-id="code-chunk-id-24" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">import</span> heapq
nums <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">,</span><span class="token number">41</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token number">75</span><span class="token punctuation">,</span><span class="token number">27</span><span class="token punctuation">,</span><span class="token number">94</span><span class="token punctuation">,</span><span class="token number">67</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">]</span>
a <span class="token operator">=</span> list<span class="token punctuation">(</span>nums<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 相当于 nums.copy()</span>
heapq<span class="token punctuation">.</span>heapify<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h4 class="mume-header" id="%E6%B3%A8%E6%84%8F">注意</h4>

<ul>
<li>当求最大/最小的一个值时，使用<code>max()/min()</code></li>
<li>当求的元素个数较少，但不是一个时，使用<code>heapq.nlargest() / heapq.nsmallest()</code></li>
<li>当求的元素个数较多，接近于集合个数时，使用<code>sorted(a)[:N] / sorted(a, reverse=True)[:N]</code></li>
</ul>
<h4 class="mume-header" id="%E6%8C%89%E4%BC%98%E5%85%88%E7%BA%A7%E6%8E%92%E5%BA%8F%E7%9A%84%E9%98%9F%E5%88%97">按优先级排序的队列</h4>

<div class="code-chunk" data-id="code-chunk-id-25" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">import</span> heapq
<span class="token keyword">class</span> <span class="token class-name">PriorityQueue</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>_index <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">def</span> <span class="token function">push</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> priority<span class="token punctuation">)</span><span class="token punctuation">:</span>
        heapq<span class="token punctuation">.</span>heappush<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_queue<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span>priority<span class="token punctuation">,</span> self<span class="token punctuation">.</span>_index<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_index <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">def</span> <span class="token function">pop</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> heapq<span class="token punctuation">.</span>heappop<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_queue<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token keyword">class</span> <span class="token class-name">Item</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> f<span class="token string">"Item({self.name})"</span>
q <span class="token operator">=</span> PriorityQueue<span class="token punctuation">(</span><span class="token punctuation">)</span>
q<span class="token punctuation">.</span>push<span class="token punctuation">(</span>Item<span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
q<span class="token punctuation">.</span>push<span class="token punctuation">(</span>Item<span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
q<span class="token punctuation">.</span>push<span class="token punctuation">(</span>Item<span class="token punctuation">(</span><span class="token string">'spam'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
q<span class="token punctuation">.</span>push<span class="token punctuation">(</span>Item<span class="token punctuation">(</span><span class="token string">'grok'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="collections-%E6%A8%A1%E5%9D%97">collections 模块</h3>

<h4 class="mume-header" id="deque">deque</h4>

<p>deque (double-ended queue) 双端队列，是一种同时具有队列和堆栈性质的数据结构。</p>
<div class="code-chunk" data-id="code-chunk-id-26" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">from</span> collections <span class="token keyword">import</span> deque
q <span class="token operator">=</span> deque<span class="token punctuation">(</span>maxlen<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
q<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
q<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
q<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span>
q<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span>
q<span class="token punctuation">.</span>appendleft<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span>
q<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span>
q<span class="token punctuation">.</span>popleft<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>可以通过<code>list</code>实现，但使用<code>collections.deque</code>队列方案更加优雅，并且运行更快。</p>
<p>在队列两端插入或删除元素的时间复杂度为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span>，而在列表的开头插入或删除元素的时间复杂度为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>N</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span></p>
<h3 class="mume-header" id="yield-%E7%9A%84%E4%BD%BF%E7%94%A8">yield 的使用</h3>

<h4 class="mume-header" id="%E5%8F%AF%E8%BF%AD%E4%BB%A3%E5%AF%B9%E8%B1%A1">可迭代对象</h4>

<p>像<code>list</code>、<code>tuple</code>、<code>dict</code>、<code>文件</code>等可以用<code>for . in ...</code>语法进行遍历的类型称为可迭代对象；你把所有的值都存放在内存中，然后逐个取出，当可迭代对象作用内存非常大时，这种方法不可取。</p>
<div class="code-chunk" data-id="code-chunk-id-27" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">a <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token operator">*</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> a<span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">" "</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> a<span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">" "</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h4 class="mume-header" id="%E7%94%9F%E6%88%90%E5%99%A8">生成器</h4>

<p>生成器是可迭代的，但是你 <strong>只可以读取它一次</strong>，因为它不是将所有数据都存放在内存中，而是实时生成的。</p>
<p>生成器在创建时用小括号：</p>
<div class="code-chunk" data-id="code-chunk-id-28" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd output=&amp;amp;quot;text&amp;amp;quot;}" class="language-python">b <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token operator">*</span>x <span class="token keyword">for</span> x <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> b<span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">" "</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> b<span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">" "</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>在运行的过程中计算出值。</p>
<h4 class="mume-header" id="yield">yield</h4>

<p><code>yield</code> 是一个类似于 <code>return</code> 的关键字，只是这个函数返回的是生成器。</p>
<div class="code-chunk" data-id="code-chunk-id-29" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">create_generator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> i
g <span class="token operator">=</span> create_generator<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> g<span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">" "</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> g<span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">" "</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E4%B8%A2%E5%A4%B1%E7%9A%84%E4%B8%89%E5%85%83%E8%BF%90%E7%AE%97%E7%AC%A6">丢失的三元运算符 ?:</h3>

<p>在C、C++、JavaScript中有三元运算符 <code>?:</code>：</p>
<div class="code-chunk" data-id="code-chunk-id-30" data-cmd="node"><div class="input-div"><pre data-role="codeBlock" data-info="node {cmd}" class="language-javascript">a <span class="token operator">=</span> <span class="token number">5</span>
b <span class="token operator">=</span> <span class="token number">9</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token operator">></span>b<span class="token operator">?</span>a<span class="token punctuation">:</span>b<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>python 中的代价语法：</p>
<div class="code-chunk" data-id="code-chunk-id-31" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">a <span class="token operator">=</span> <span class="token number">5</span>
b <span class="token operator">=</span> <span class="token number">9</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token keyword">if</span> a<span class="token operator">></span>b <span class="token keyword">else</span> b<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E4%B8%A2%E5%A4%B1%E7%9A%84for%E8%AF%AD%E5%8F%A5">丢失的for语句</h3>

<p>在C、C++、JavaScript中有<code>for</code>语句：</p>
<div class="code-chunk" data-id="code-chunk-id-32" data-cmd="node"><div class="input-div"><pre data-role="codeBlock" data-info="node {cmd}" class="language-javascript"><span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">%</span><span class="token number">2</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>在Python中：</p>
<div class="code-chunk" data-id="code-chunk-id-33" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token punctuation">[</span><span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">" "</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">if</span> i<span class="token operator">%</span><span class="token number">2</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">]</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="python%E7%9A%84%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2">Python的格式化字符串</h3>

<h4 class="mume-header" id="%E4%BD%BF%E7%94%A8%E6%93%8D%E4%BD%9C%E7%AC%A6">使用%操作符</h4>

<p>从版本1.0就存在的字符串格式化方式：</p>
<div class="code-chunk" data-id="code-chunk-id-34" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">name <span class="token operator">=</span> <span class="token string">'Fred'</span>
height <span class="token operator">=</span> <span class="token number">176.23</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"My name is %s, height is %.1f cm"</span> <span class="token operator">%</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h4 class="mume-header" id="%E4%BD%BF%E7%94%A8stringformat">使用string.format</h4>

<p>从版本2.6开始引入：</p>
<div class="code-chunk" data-id="code-chunk-id-35" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">name <span class="token operator">=</span> <span class="token string">'Fred'</span>
height <span class="token operator">=</span> <span class="token number">176.23</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"My name is {0}, height is {1:.1f} cm"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>name<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"My name is {sname}, height is {sheight:.1f} cm"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>sheight<span class="token operator">=</span>height<span class="token punctuation">,</span> sname<span class="token operator">=</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h4 class="mume-header" id="%E4%BD%BF%E7%94%A8-f-%E5%AD%97%E7%AC%A6%E4%B8%B2">使用 f 字符串</h4>

<p>从版本3.6开始引入：</p>
<div class="code-chunk" data-id="code-chunk-id-36" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">name <span class="token operator">=</span> <span class="token string">'Fred'</span>
height <span class="token operator">=</span> <span class="token number">176.23</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"My name is {name}, height is {height:.1f} cm"</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h2 class="mume-header" id="%E5%86%85%E9%83%A8%E5%87%BD%E6%95%B0">内部函数</h2>

<ul>
<li><code>dir</code>：用于显示模块/类的属性</li>
</ul>
<h2 class="mume-header" id="python%E7%9A%84%E7%B1%BB">Python的类</h2>

<p><strong>Python</strong> 中并不存在真正私有的方法。</p>
<h3 class="mume-header" id="python%E7%B1%BB%E4%B8%AD%E5%B1%9E%E6%80%A7%E6%96%B9%E6%B3%95%E5%91%BD%E5%90%8D">Python类中属性/方法命名</h3>

<h4 class="mume-header" id="%E4%BB%A5%E4%B8%80%E4%B8%AA%E4%B8%8B%E5%88%92%E7%BA%BF%E5%BC%80%E5%A4%B4-_foo">以一个下划线开头 _foo</h4>

<p>使用这种命名的原因：</p>
<ul>
<li>不希望它被直接import</li>
<li>不希望它被直接访问</li>
<li>只是测试中的 function</li>
</ul>
<p>例如，我们写了一个 <code>test.py</code>:</p>
<div class="code-chunk" data-id="b1934f7bd7a14aa83556291aca6c323d" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="py cmd=&amp;amp;quot;python&amp;amp;quot; id=&amp;amp;quot;b1934f7bd7a14aa83556291aca6c323d&amp;amp;quot; code_chunk_offset=0" class="language-python"><span class="token keyword">def</span> <span class="token function">public_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"I am aviliable"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">_private_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"I am not aviliable"</span><span class="token punctuation">)</span>


</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p><strong>真的不能<code>import</code>?</strong></p>
<div class="code-chunk" data-id="code-chunk-id-38" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">from</span> test <span class="token keyword">import</span> <span class="token operator">*</span>
public_func<span class="token punctuation">(</span><span class="token punctuation">)</span>
_private_func<span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>上面的代码说明不能通过<code>from module_name import *</code> 的方式使用<code>_foo</code>函数；</p>
<div class="code-chunk" data-id="code-chunk-id-39" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">from</span> test <span class="token keyword">import</span> _private_func
_private_func<span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>但可以通过 <code>from modele_name import _foo</code> 的方式使用<code>_foo</code>函数；</p>
<h4 class="mume-header" id="%E4%BB%A5%E4%B8%80%E4%B8%AA%E4%B8%8B%E5%88%92%E7%BA%BF%E7%BB%93%E5%B0%BE-foo_">以一个下划线结尾 foo_</h4>

<p>如<code>foo_</code>，这种方式主要是为了避免与Python的 <strong>built-in keywords</strong> 和 <strong>built-in functions</strong> 取一样的名字。</p>
<ol>
<li>如果命名与<strong>built-in functions</strong>相同：</li>
</ol>
<div class="code-chunk" data-id="code-chunk-id-40" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
list <span class="token operator">=</span> <span class="token number">12</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>会造成原 <strong>built-in functions</strong> 不能使用，改进为：</p>
<div class="code-chunk" data-id="code-chunk-id-41" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
list_ <span class="token operator">=</span> <span class="token number">12</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>list<span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><ol start="2">
<li>如果命名与<strong>built-in keywords</strong>相同：</li>
</ol>
<div class="code-chunk" data-id="code-chunk-id-42" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">is</span><span class="token operator">=</span><span class="token number">12</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>将直接抛出一个语法异常。</p>
<ul>
<li>双下划线开头：在类成员中表示名字改编，这是为了使其避免与子类中的名字冲突</li>
</ul>
<h4 class="mume-header" id="__foo__">__foo__</h4>

<p>不要使用，除非你是 Python 的核心开发人员。</p>
<h4 class="mume-header" id="__foo">__foo</h4>

<div class="code-chunk" data-id="code-chunk-id-43" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__foo1</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"called A::__foo1"</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">foo2</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"called A::foo2"</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n--- f ---"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>__foo1<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>foo2<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token operator">*</span><span class="token number">9</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">"\n"</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>

a <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>dir<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"..."</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 实现了变名</span>
a<span class="token punctuation">.</span>_A__foo1<span class="token punctuation">(</span><span class="token punctuation">)</span>

a<span class="token punctuation">.</span>f<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__foo1</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"called B::__foo1"</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">foo2</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"called B::foo2"</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> B<span class="token punctuation">(</span><span class="token punctuation">)</span>
b<span class="token punctuation">.</span>f<span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p><strong>总结：</strong></p>
<ul>
<li>如果要引用<code>__foo</code>函数，需要通过变换后的名：<code>_modulename__foo</code></li>
<li><code>__foo</code> 类似的方法/属性不能被子类重写；</li>
</ul>
<h3 class="mume-header" id="%E7%B1%BB%E7%9A%84%E5%86%85%E7%BD%AE%E6%8E%A5%E5%8F%A3">类的内置接口</h3>

<h4 class="mume-header" id="__repr__">__repr__</h4>

<div class="code-chunk" data-id="code-chunk-id-44" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"I am A"</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>A<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h2 class="mume-header" id="%E8%8E%B7%E5%8F%96%E5%85%A8%E6%8E%92%E5%88%97">获取全排列</h2>

<div class="code-chunk" data-id="code-chunk-id-45" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">import</span> itertools
<span class="token keyword">for</span> i <span class="token keyword">in</span> itertools<span class="token punctuation">.</span>permutations<span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h2 class="mume-header" id="%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%92%8C%E6%96%87%E6%9C%AC">字符串和文本</h2>

<h3 class="mume-header" id="%E4%BD%BF%E7%94%A8%E5%A4%9A%E4%B8%AA%E7%95%8C%E5%AE%9A%E7%AC%A6%E5%88%86%E5%89%B2%E5%AD%97%E7%AC%A6%E4%B8%B2">使用多个界定符分割字符串</h3>

<div class="code-chunk" data-id="code-chunk-id-46" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">line <span class="token operator">=</span> <span class="token string">"asdf  fjk;  fj,ek, foo"</span>
<span class="token keyword">import</span> re
<span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>split<span class="token punctuation">(</span>r<span class="token string">'[\s\;\,]+'</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">)</span>
fields <span class="token operator">=</span> re<span class="token punctuation">.</span>split<span class="token punctuation">(</span>r<span class="token string">'([;,\s]+)'</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>fields<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 捕获与非捕获</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>split<span class="token punctuation">(</span>r<span class="token string">'(\s|,|;)+'</span><span class="token punctuation">,</span>line<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># (?:...)表示非捕获</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>split<span class="token punctuation">(</span>r<span class="token string">'(?:\s|,|;)+'</span><span class="token punctuation">,</span>line<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>使用<code>re.split()</code>函数时，需要特别注意的是正则表达式中是否包含一个括号捕获分组。如果使用了分组捕获，那么被匹配的文本也将出现在结果列表中；</p>
<h3 class="mume-header" id="%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%BC%80%E5%A4%B4%E6%88%96%E7%BB%93%E5%B0%BE%E5%8C%B9%E9%85%8D">字符串开头或结尾匹配</h3>

<div class="code-chunk" data-id="code-chunk-id-47" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">import</span> re
<span class="token comment" spellcheck="true"># 使用 str.startswith str.endswith</span>
filename <span class="token operator">=</span> <span class="token string">"spam.txt"</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>filename<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'file:'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>filename<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'.txt'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>filename<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">".txt"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">'[\s\S]*\.(txt|c)$'</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>filename<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'.txt'</span><span class="token punctuation">,</span><span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 检查匹配并归类</span>
filenames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Makefile'</span><span class="token punctuation">,</span><span class="token string">'foo.c'</span><span class="token punctuation">,</span><span class="token string">'bar.py'</span><span class="token punctuation">,</span><span class="token string">'spam.c'</span><span class="token punctuation">,</span><span class="token string">'spam.h'</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>f <span class="token keyword">for</span> f <span class="token keyword">in</span> filenames <span class="token keyword">if</span> f<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'.c'</span><span class="token punctuation">,</span><span class="token string">'.h'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>any<span class="token punctuation">(</span>f<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'py'</span><span class="token punctuation">)</span> <span class="token keyword">for</span> f <span class="token keyword">in</span> filenames<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E7%94%A8-shell-%E9%80%9A%E9%85%8D%E7%AC%A6%E5%8C%B9%E9%85%8D%E5%AD%97%E7%AC%A6%E4%B8%B2">用 shell 通配符匹配字符串</h3>

<p>你可以使用Unix Shell 中常用的通配符（比如：<em>.py，Dat[0-9]</em>.csv等）去匹配文本字符串。</p>
<div class="code-chunk" data-id="code-chunk-id-48" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">from</span> fnmatch <span class="token keyword">import</span> fnmatch<span class="token punctuation">,</span> fnmatchcase
<span class="token keyword">print</span><span class="token punctuation">(</span>fnmatch<span class="token punctuation">(</span><span class="token string">'foo.txt'</span><span class="token punctuation">,</span> <span class="token string">'*.txt'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>fnmatch<span class="token punctuation">(</span><span class="token string">'foo.txt'</span><span class="token punctuation">,</span> <span class="token string">'?oo.txt'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>fnmatch<span class="token punctuation">(</span><span class="token string">'Dat45.csv'</span><span class="token punctuation">,</span><span class="token string">'Dat[0-9]*'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 大小写敏感(mac os)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>fnmatch<span class="token punctuation">(</span><span class="token string">'foo.txt'</span><span class="token punctuation">,</span> <span class="token string">'*.TXT'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>fnmatchcase<span class="token punctuation">(</span><span class="token string">'foo.txt'</span><span class="token punctuation">,</span> <span class="token string">'*.TXT'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

addresses <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'5412 N CLARK ST'</span><span class="token punctuation">,</span>
    <span class="token string">'1060 W ADDISON ST'</span><span class="token punctuation">,</span>
    <span class="token string">'1039 W GRANVILLE AVE'</span><span class="token punctuation">,</span>
    <span class="token string">'2122 N CLARK ST'</span><span class="token punctuation">,</span>
    <span class="token string">'4802 N BROADWAY'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>addr <span class="token keyword">for</span> addr <span class="token keyword">in</span> addresses <span class="token keyword">if</span> fnmatch<span class="token punctuation">(</span>addr<span class="token punctuation">,</span> <span class="token string">'* ST'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>addr <span class="token keyword">for</span> addr <span class="token keyword">in</span> addresses <span class="token keyword">if</span> fnmatch<span class="token punctuation">(</span>addr<span class="token punctuation">,</span> <span class="token string">'54[0-9]*CLARK*'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p><code>fnmatch()</code>函数的匹配能力介于简单的字符串方法和强大的正则表达式之间。如果在数据处理操作中只需要简单的通配符就能完成的时候，这通常是一个比较合理的方案。</p>
<p>如果你的代码需要做文件名的匹配，最好使用glob模块。</p>
<h3 class="mume-header" id="%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%B9%E9%85%8D%E5%92%8C%E6%90%9C%E7%B4%A2">字符串匹配和搜索</h3>

<div class="code-chunk" data-id="code-chunk-id-49" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token comment" spellcheck="true"># 简单的搜索</span>
text <span class="token operator">=</span> <span class="token string">'yeah, but no, but yeah, but no, but yeah'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'no'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 对于复杂的匹配，使用 re 模块</span>
<span class="token keyword">import</span> re
text1 <span class="token operator">=</span> <span class="token string">'11/27/2012'</span>
text2 <span class="token operator">=</span> <span class="token string">'Nov 27, 2012'</span>
datepat <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">'\d+/\d+/\d+'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 方式1：re.match</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'yes'</span> <span class="token keyword">if</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span>datepat<span class="token punctuation">,</span> text1<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">'no'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 方式2：pat.match</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'yes'</span> <span class="token keyword">if</span> datepat<span class="token punctuation">.</span>match<span class="token punctuation">(</span>text2<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">'no'</span><span class="token punctuation">)</span>

text <span class="token operator">=</span> <span class="token string">'Today is 11/27/2012. PyCon starts 3/13/2013.'</span>
<span class="token comment" spellcheck="true"># re.match 总是从字符串开始去匹配</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'yes'</span> <span class="token keyword">if</span> datepat<span class="token punctuation">.</span>match<span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">'no'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 任意位置查找</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>datepat<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 在定义正则式时，通常会利用括号去捕获分组</span>
datepat <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">'(\d+)/(\d+)/(\d+)'</span><span class="token punctuation">)</span>
m <span class="token operator">=</span> datepat<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">'11/27/2012'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>groups<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>datepat<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 时间格式转换</span>
<span class="token keyword">for</span> month<span class="token punctuation">,</span> day<span class="token punctuation">,</span> year <span class="token keyword">in</span> datepat<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'{year}-{month}-{day}'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># findall 以列表形式返回，finditer 以生成器方式返回</span>
<span class="token keyword">for</span> m <span class="token keyword">in</span> datepat<span class="token punctuation">.</span>finditer<span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    month<span class="token punctuation">,</span> day<span class="token punctuation">,</span> year <span class="token operator">=</span> m<span class="token punctuation">.</span>groups<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'{year}-{month}-{day}'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># match 只检查字符串的开头部分</span>
m <span class="token operator">=</span> datepat<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">"11/27/2012ddasdf"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'yes'</span> <span class="token keyword">if</span> m <span class="token keyword">else</span> <span class="token string">'no'</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>注意：如果你打算做大量的匹配和搜索操作的话，最好先编译正则表达式，然后再重复使用它。模块级别的函数会将最近编译过的模式缓存起来，不会有太多的性能消耗，但如果使用预编译模式的话，你将会减少查找和一些额外的处理损耗。</p>
<h3 class="mume-header" id="%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%90%9C%E7%B4%A2%E5%92%8C%E6%9B%BF%E6%8D%A2">字符串搜索和替换</h3>

<div class="code-chunk" data-id="code-chunk-id-50" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token comment" spellcheck="true"># 简单的字符串替换</span>
text <span class="token operator">=</span> <span class="token string">'yeah, but no, but yeah, but no'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'yeah'</span><span class="token punctuation">,</span> <span class="token string">'yep'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 复杂的字符串替换</span>
<span class="token keyword">import</span> re
text <span class="token operator">=</span> <span class="token string">'Today is 11/27/2012. PyCon starts 3/13/2013.'</span>
datepat <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">'(\d+)/(\d+)/(\d+)'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>datepat<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>r<span class="token string">'\3-\1-\2'</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 可读性更强的一种方式</span>
<span class="token comment" spellcheck="true"># (?P&lt;name>\d+) 表示捕获为name变量</span>
<span class="token comment" spellcheck="true"># \g&lt;name> 使用name</span>
datepat <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">'(?P&lt;month>\d+)/(?P&lt;day>\d+)/(?P&lt;year>\d+)'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>datepat<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>r<span class="token string">'\g&lt;year>-\g&lt;month>-\g&lt;day>'</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>对于更加复杂的替换，可以传递一个替换回调函数来替代：</p>
<div class="code-chunk" data-id="code-chunk-id-51" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">import</span> re
<span class="token keyword">from</span> calendar <span class="token keyword">import</span> month_abbr
text <span class="token operator">=</span> <span class="token string">'Today is 11/27/2012. PyCon starts 3/13/2013.'</span>
datepat <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">'(?P&lt;m>\d+)/(?P&lt;d>\d+)/(?P&lt;y>\d+)'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">change_date</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>
    mon_name <span class="token operator">=</span> month_abbr<span class="token punctuation">[</span>int<span class="token punctuation">(</span>m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token string">'m'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> f<span class="token string">"{m.group('d')} {mon_name} {m.group('y')}"</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>datepat<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>change_date<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 第一个返回值为替换结果，第二个返回值为替换次数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>datepat<span class="token punctuation">.</span>subn<span class="token punctuation">(</span>change_date<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%BF%BD%E7%95%A5%E5%A4%A7%E5%B0%8F%E5%86%99%E7%9A%84%E6%90%9C%E7%B4%A2%E6%9B%BF%E6%8D%A2">字符串忽略大小写的搜索替换</h3>

<div class="code-chunk" data-id="code-chunk-id-52" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">import</span> re
text <span class="token operator">=</span> <span class="token string">'UPPER PYTHON, lower python, Mixed Python'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'python'</span><span class="token punctuation">,</span> text<span class="token punctuation">,</span> flags<span class="token operator">=</span>re<span class="token punctuation">.</span>IGNORECASE<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>r<span class="token string">'python'</span><span class="token punctuation">,</span> <span class="token string">'snake'</span><span class="token punctuation">,</span> text<span class="token punctuation">,</span> flags<span class="token operator">=</span>re<span class="token punctuation">.</span>IGNORECASE<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">matchCase</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">replace</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>
        text <span class="token operator">=</span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> text<span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> word<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> text<span class="token punctuation">.</span>islower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> word<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> text<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isupper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> word<span class="token punctuation">.</span>capitalize<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> word
    <span class="token keyword">return</span> replace
<span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">'python'</span><span class="token punctuation">,</span>matchCase<span class="token punctuation">(</span><span class="token string">'snake'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    text <span class="token punctuation">,</span>flags<span class="token operator">=</span>re<span class="token punctuation">.</span>IGNORECASE<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>注：上面的后面的例子中，<code>matchCase('snake')</code>返回了一个回调函数。</p>
<h3 class="mume-header" id="%E6%9C%80%E7%9F%AD%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%BC%8F">最短匹配模式</h3>

<p>你正在使用正则表达式匹配某个文本模式，但是它找到的可能是最长匹配。修改变为最短匹配：</p>
<div class="code-chunk" data-id="code-chunk-id-53" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">import</span> re
text1 <span class="token operator">=</span> <span class="token string">'Computer says "no."'</span>
text2 <span class="token operator">=</span> <span class="token string">'Computer says "no." Phone says "yes."'</span>
str_pat <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">'\"(.*)\"'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>str_pat<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>text1<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 最长匹配的例子(贪婪模式)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>str_pat<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>text2<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 使用最短匹配 在匹配模式后加上 ? (懒惰模式)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'\"(.*?)\"'</span><span class="token punctuation">,</span> text2<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E5%A4%9A%E8%A1%8C%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%BC%8F">多行匹配模式</h3>

<div class="code-chunk" data-id="code-chunk-id-54" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">import</span> re
comment <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">'/\*(.*?)\*/'</span><span class="token punctuation">)</span>
text1 <span class="token operator">=</span> <span class="token string">'/* This is one-line of comment */'</span>
text2 <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
/*This is multi-line
 comment*/
"""</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>comment<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>text1<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>comment<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>text2<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># '?'在后面表示最短匹配，'?:'在捕获组的前面表示不进行捕获</span>
comment <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">'/\*([\s\S]*?)\*/'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>comment<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>text2<span class="token punctuation">)</span><span class="token punctuation">)</span>
comment <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span>r<span class="token string">"/\*((?:.|\n)*)\*/"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>comment<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>text2<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 使用 re.DOTALL 让点匹配所有字符</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'/\*(.*)\*/'</span><span class="token punctuation">,</span> text2<span class="token punctuation">,</span> flags<span class="token operator">=</span>re<span class="token punctuation">.</span>DOTALL<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E5%88%A0%E9%99%A4%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E4%B8%8D%E9%9C%80%E8%A6%81%E7%9A%84%E5%AD%97%E7%AC%A6">删除字符串中不需要的字符</h3>

<div class="code-chunk" data-id="code-chunk-id-55" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">import</span> re
<span class="token comment" spellcheck="true"># 使用 str.strip、str.lstrip、str.rstrip</span>
<span class="token comment" spellcheck="true"># 删除开头/结尾的指定字符串 不会删除中间的字符</span>
s <span class="token operator">=</span> <span class="token string">'   hello   world  '</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"'{s.strip()}'"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"'{s.lstrip()}'"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"'{s.rstrip()}'"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># strip 的参数中字符是或的关系</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"'{s.strip(' hd')}'"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 删除中间的空格</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"'{s.strip().replace(' ','')}'"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 删除中间多余的空格</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"'{0}'"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>r<span class="token string">'\s+'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E5%AE%A1%E6%9F%A5%E6%B8%85%E7%90%86%E6%96%87%E6%9C%AC%E6%95%B0%E6%8D%AE%E5%AD%97%E7%AC%A6%E4%B8%B2">审查清理文本数据字符串</h3>

<div class="code-chunk" data-id="code-chunk-id-56" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token comment" spellcheck="true"># 改写指定字母</span>
text <span class="token operator">=</span> <span class="token string">'life is short, please use python'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>text<span class="token punctuation">.</span>translate<span class="token punctuation">(</span><span class="token punctuation">{</span>
    ord<span class="token punctuation">(</span><span class="token string">'s'</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token string">'S'</span><span class="token punctuation">,</span>
    ord<span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token string">'pop'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AF%B9%E9%BD%90">字符串对齐</h3>

<div class="code-chunk" data-id="code-chunk-id-57" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">hw <span class="token operator">=</span> <span class="token string">"hello,world"</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"'{hw.ljust(20)}'"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"\'{format(hw, '&lt;20')}\'"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"'{:&lt;20}'"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>hw<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"'{hw.rjust(20)}'"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"\'{format(hw, '>20')}\'"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"'{:>20}'"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>hw<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"'{hw.center(20)}'"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"\'{format(hw, '^20')}\'"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"'{:^20}'"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>hw<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"'{hw.center(20,'*')}'"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"\'{format(hw, '*^20s')}\'"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"'{:*^20s}'"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>hw<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"\'{hw:*^20s}\'"</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 格式化数字</span>
x <span class="token operator">=</span> <span class="token number">1.2345</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"{x:>10}|"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"{x:&lt;10}|"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 默认 . 后面是精确位数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"{x:^+10.3}|"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 加了f后表示小数点后几位</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"{x:^+10.3f}|"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"{x:$^10.2}|"</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E5%90%88%E5%B9%B6%E6%8B%BC%E6%8E%A5%E5%AD%97%E7%AC%A6%E4%B8%B2">合并拼接字符串</h3>

<p>将几个小的字符串合并为一个。</p>
<div class="code-chunk" data-id="code-chunk-id-58" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token comment" spellcheck="true"># 如果要合并的字符串时一个序列或iterable</span>
parts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Is'</span><span class="token punctuation">,</span> <span class="token string">'Chicago'</span><span class="token punctuation">,</span> <span class="token string">'Not'</span><span class="token punctuation">,</span> <span class="token string">'Chicago'</span><span class="token punctuation">]</span>
parts_dic <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'a'</span><span class="token punctuation">:</span><span class="token string">'Is'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">:</span><span class="token string">'Chicago'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span><span class="token string">'Not'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">:</span><span class="token string">'Chi'</span><span class="token punctuation">}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>parts<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">' , '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>parts<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>parts<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>parts_dic<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 用 + 连接</span>
a <span class="token operator">=</span> <span class="token string">'Is Chicago'</span>
b <span class="token operator">=</span> <span class="token string">"Not Chicago"</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> b<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 两个字符串字面量直接并排合并</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hello'</span> <span class="token string">' '</span> <span class="token string">'world'</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>编写字符串相关的程序时，要注意效率：</p>
<div class="code-chunk" data-id="code-chunk-id-59" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ACME'</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">91.1</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 不可取的做法, +操作符存在大量内存复制、垃圾回收</span>
s <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> data<span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># + 操作存在</span>
    s <span class="token operator">+=</span> str<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">','</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 好一些的做法</span>
s <span class="token operator">=</span> <span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>str<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>

a <span class="token operator">=</span> <span class="token string">'1'</span><span class="token punctuation">;</span> b<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">;</span> c<span class="token operator">=</span><span class="token string">'3'</span>
<span class="token comment" spellcheck="true"># ugly mode</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> b <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span>c<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># still ugle</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># better</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>sep<span class="token operator">=</span><span class="token string">":"</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>当混合使用I/O操作和字符串操作时，有时候需要仔细研究你的程序：</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token comment" spellcheck="true"># Versino 1 : string connection</span>
<span class="token comment" spellcheck="true"># 如果s1、s2较小时合适，i/o操作通常较慢</span>
<span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'filename'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>s1 <span class="token operator">+</span> s2<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Version 2 : seperate I/O operations</span>
<span class="token comment" spellcheck="true"># 如果s1、s2较大时合适，避免 + 的大量内存占用 </span>
<span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'filename'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>s1<span class="token punctuation">)</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>s2<span class="token punctuation">)</span>
</pre><p>大量小字符串的输出：</p>
<div class="code-chunk" data-id="code-chunk-id-60" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">sample</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">yield</span> <span class="token string">'Is'</span>
    <span class="token keyword">yield</span> <span class="token string">'Chicago'</span>
    <span class="token keyword">yield</span> <span class="token string">'Not'</span>
    <span class="token keyword">yield</span> <span class="token string">'Chicago'</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>sample<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> sample<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F%E6%9B%BF%E6%8D%A2">字符串中的变量替换</h3>

<div class="code-chunk" data-id="code-chunk-id-61" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">name <span class="token operator">=</span> <span class="token string">'Fred'</span>
weight <span class="token operator">=</span> <span class="token number">71.32</span>
<span class="token comment" spellcheck="true"># 原始版本</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'I am %s, weight is %.1f'</span> <span class="token operator">%</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> weight<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># f 字符串版本</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'I am {name} ,weight is {weight:#^10.1f}'</span> <span class="token operator">%</span>vars<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="html-%E5%92%8C-xml-%E7%9A%84%E8%BD%AC%E6%8D%A2">html 和 xml 的转换</h3>

<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">import</span> html
<span class="token comment" spellcheck="true"># 将html中的特殊字符进行转换，使其能够在html中显示</span>
text <span class="token operator">=</span> <span class="token string">'This is &lt;strong> "strong text" &lt;/strong>'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>html<span class="token punctuation">.</span>escape<span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># html.escape的第二个参数quote指示是否替换冒号</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>html<span class="token punctuation">.</span>escape<span class="token punctuation">(</span>text<span class="token punctuation">,</span> quote<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># html.escape 的反过程</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>html<span class="token punctuation">.</span>unescape<span class="token punctuation">(</span><span class="token string">'This is &amp;lt;strong&amp;gt; &amp;quot;strong text&amp;quot; &amp;lt;/strong&amp;gt;'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><pre data-role="codeBlock" data-info="" class="language-"><code>This is &lt;strong&gt; &quot;strong text&quot; &lt;/strong&gt;
This is &amp;lt;strong&amp;gt; &amp;quot;strong text&amp;quot; &amp;lt;/strong&amp;gt;
This is &amp;lt;strong&amp;gt; &quot;strong text&quot; &amp;lt;/strong&amp;gt;
This is &lt;strong&gt; &quot;strong text&quot; &lt;/strong&gt;
</code></pre><h3 class="mume-header" id="%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BB%A4%E7%89%8C%E8%A7%A3%E6%9E%90">字符串令牌解析</h3>

<p>目标：将<code>text = 'foo = 23 + 42 * 10'</code><br>
解析为：<code>tokens = [('NAME', 'foo'), ('EQ','='), ('NUM', '23'), ('PLUS','+'), ('NUM', '42'), ('TIMES', '*'), ('NUM', '10')]</code></p>
<div class="code-chunk" data-id="code-chunk-id-62" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">import</span> re
<span class="token comment" spellcheck="true"># 定义令牌</span>
NAME <span class="token operator">=</span> r<span class="token string">'(?P&lt;NAME>[a-zA-Z][a-zA-Z0-9_]*)'</span>
NUM <span class="token operator">=</span> r<span class="token string">'(?P&lt;NUM>\d+)'</span>
PLUS <span class="token operator">=</span> r<span class="token string">'(?P&lt;PLUS>\+)'</span>
TIMES <span class="token operator">=</span> r<span class="token string">'(?P&lt;TIMES>\*)'</span>
EQ <span class="token operator">=</span> r<span class="token string">'(?P&lt;EQ>=)'</span>
WS <span class="token operator">=</span> r<span class="token string">'(?P&lt;WS>\s+)'</span>
master_pat <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>NAME<span class="token punctuation">,</span> NUM<span class="token punctuation">,</span> PLUS<span class="token punctuation">,</span> TIMES<span class="token punctuation">,</span> EQ<span class="token punctuation">,</span> WS<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 使用scanner进行扫描 方法1</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"{:*^30s}"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token string">' scanner method 1 '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
scanner <span class="token operator">=</span> master_pat<span class="token punctuation">.</span>scanner<span class="token punctuation">(</span><span class="token string">'foo = 42'</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    m <span class="token operator">=</span> scanner<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> m<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>lastgroup<span class="token punctuation">,</span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'{:*^30s}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token string">' scanner method 2 '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 方式2</span>
scanner <span class="token operator">=</span> master_pat<span class="token punctuation">.</span>scanner<span class="token punctuation">(</span><span class="token string">'foo = 42'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> m <span class="token keyword">in</span> iter<span class="token punctuation">(</span>scanner<span class="token punctuation">.</span>match<span class="token punctuation">,</span> None<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>lastgroup<span class="token punctuation">,</span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 方式3</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'{:*^30s}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token string">' scanner method 3 '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> collections <span class="token keyword">import</span> namedtuple
<span class="token keyword">def</span> <span class="token function">generate_token</span><span class="token punctuation">(</span>pat<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Token <span class="token operator">=</span> namedtuple<span class="token punctuation">(</span><span class="token string">'Token'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">,</span><span class="token string">'value'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    scanner <span class="token operator">=</span> pat<span class="token punctuation">.</span>scanner<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    <span class="token keyword">for</span> m <span class="token keyword">in</span> iter<span class="token punctuation">(</span>scanner<span class="token punctuation">.</span>match<span class="token punctuation">,</span> None<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> Token<span class="token punctuation">(</span>m<span class="token punctuation">.</span>lastgroup<span class="token punctuation">,</span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> tok <span class="token keyword">in</span> generate_token<span class="token punctuation">(</span>master_pat<span class="token punctuation">,</span> <span class="token string">'foo = 42'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>tok<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 过滤生成的符号</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'{:*^30s}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token string">' filter the tokens '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
tokens <span class="token operator">=</span> <span class="token punctuation">(</span>t <span class="token keyword">for</span> t <span class="token keyword">in</span> generate_token<span class="token punctuation">(</span>master_pat<span class="token punctuation">,</span> <span class="token string">'foo = 42'</span><span class="token punctuation">)</span> 
    <span class="token keyword">if</span> t<span class="token punctuation">.</span>type<span class="token operator">!=</span><span class="token string">'WS'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> t <span class="token keyword">in</span> tokens<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>通常来讲，令牌化是很多高级文本解析与处理的第一步，为了使用上面的扫描方法，你需要记住：</p>
<ol>
<li>你必须确认你使用正则表达式指定了所有输入中可能出现的文本序列，如果有任何不可匹配的文本出现，扫描就会直接停止；</li>
<li>令牌顺序也是有影响的，<code>re</code> 模块会按照指定好的顺序去做匹配，因此如果一个模式恰好是另一个更长模式的子字符串，你需要将长模式写在前面，如：</li>
</ol>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">import</span> re
LT <span class="token operator">=</span> r<span class="token string">'(?P&lt;LT>&lt;)'</span>
LE <span class="token operator">=</span> r<span class="token string">'(?P&lt;LE>&lt;=)'</span>
EQ <span class="token operator">=</span> r<span class="token string">'(?P&lt;EQ>=)'</span>
<span class="token comment" spellcheck="true"># incorrect method</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'{:*^30s}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token string">'incorrect method'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
master_pat <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>LT<span class="token punctuation">,</span> LE<span class="token punctuation">,</span> EQ<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
scanner <span class="token operator">=</span> master_pat<span class="token punctuation">.</span>scanner<span class="token punctuation">(</span><span class="token string">'&lt;='</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> m <span class="token keyword">in</span> iter<span class="token punctuation">(</span>scanner<span class="token punctuation">.</span>match<span class="token punctuation">,</span> None<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>lastgroup<span class="token punctuation">,</span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'{:*^30s}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token string">'correct method'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
master_pat <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>LE<span class="token punctuation">,</span> LT<span class="token punctuation">,</span> EQ<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
scanner <span class="token operator">=</span> master_pat<span class="token punctuation">.</span>scanner<span class="token punctuation">(</span><span class="token string">'&lt;='</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> m <span class="token keyword">in</span> iter<span class="token punctuation">(</span>scanner<span class="token punctuation">.</span>match<span class="token punctuation">,</span> None<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>lastgroup<span class="token punctuation">,</span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><pre data-role="codeBlock" data-info="" class="language-"><code>*******incorrect method*******
(&apos;LT&apos;, &apos;&lt;&apos;)
(&apos;EQ&apos;, &apos;=&apos;)
********correct method********
(&apos;LE&apos;, &apos;&lt;=&apos;)
</code></pre><ol start="3">
<li>留意子字符串形式的模式，比如你有以下两个模式：</li>
</ol>
<div class="code-chunk" data-id="code-chunk-id-63" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">import</span> re
PRINT <span class="token operator">=</span> r<span class="token string">'(?P&lt;PRINT>print)'</span>
NAME <span class="token operator">=</span> r<span class="token string">'(?P&lt;NAME>[a-zA-Z_][a-zA-Z0-9_]*)'</span>
master_pat <span class="token operator">=</span> re<span class="token punctuation">.</span>compile<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>PRINT<span class="token punctuation">,</span> NAME<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
scanner <span class="token operator">=</span> master_pat<span class="token punctuation">.</span>scanner<span class="token punctuation">(</span><span class="token string">'printer'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> m <span class="token keyword">in</span> iter<span class="token punctuation">(</span>scanner<span class="token punctuation">.</span>match<span class="token punctuation">,</span> None<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>lastgroup<span class="token punctuation">,</span> m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>更高阶的令牌化技术可能需要查看 <em>PyParsing</em> 或者 <em>PLY</em> 包。</p>
<h3 class="mume-header" id="%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E9%80%92%E5%BD%92%E4%B8%8B%E9%99%8D%E5%88%86%E6%9E%90%E5%99%A8">一个简单的递归下降分析器</h3>

<p>要求：根据一组语法规则解析文本并执行命令，或者构造一个代表输入的抽象语法树，如果语法非常简单，你可以自己写这个解析器，而不是使用一些框架。</p>
<p>解决方案：<br>
在这个问题中，我们集中讨论特殊语法去解析文本的问题。为了这样做，你首先要以BNF或EBNF形式指定一个标准语法，比如，一个简单数学表达式语法可能像下面：</p>
<pre data-role="codeBlock" data-info="" class="language-"><code>expr ::= expr + term
    | expr - term
    | term
term ::= term * factor
    | term /  factor
    | factor
factor ::= (expr)
    | NUM
</code></pre><p>或者，以EBNF形式：</p>
<pre data-role="codeBlock" data-info="" class="language-"><code>expr ::= term {(+|-) term}*
term ::= factor {(*|/) factor}*
factor ::= (expr)
    | NUM
</code></pre><p>在EBNF中，包含在 {...}* 中的规则是可选的。* 表示0次或多次重复。</p>
<p>对于复杂的语法，你最好是选择某个解析工具，如PyParsing 或者是 PLY，下面是使用PLY写的表达式求值程序：</p>
<div class="code-chunk" data-id="code-chunk-id-64" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">from</span> ply<span class="token punctuation">.</span>yacc <span class="token keyword">import</span> yacc
<span class="token keyword">from</span> ply<span class="token punctuation">.</span>lex <span class="token keyword">import</span> lex

<span class="token comment" spellcheck="true"># Token list</span>
tokens<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'NUM'</span><span class="token punctuation">,</span><span class="token string">'PLUS'</span><span class="token punctuation">,</span><span class="token string">'MINUS'</span><span class="token punctuation">,</span><span class="token string">'TIMES'</span><span class="token punctuation">,</span><span class="token string">'DIVIDE'</span><span class="token punctuation">,</span><span class="token string">'LPAREN'</span><span class="token punctuation">,</span><span class="token string">'RPAREN'</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># Ignored characters</span>
t_ignore <span class="token operator">=</span> <span class="token string">' \t\n'</span>
<span class="token comment" spellcheck="true"># Token specifications (as regexs)</span>
t_PLUS <span class="token operator">=</span> r<span class="token string">'\+'</span>
t_MINUS <span class="token operator">=</span> r<span class="token string">'\-'</span>
t_TIMES <span class="token operator">=</span> r<span class="token string">'\*'</span>
t_DIVIDE <span class="token operator">=</span> r<span class="token string">'/'</span>
t_LPAREN <span class="token operator">=</span> r<span class="token string">'\('</span>
t_RPAREN <span class="token operator">=</span> r<span class="token string">'\)'</span>

<span class="token comment" spellcheck="true"># Token processing functions</span>
<span class="token keyword">def</span> <span class="token function">t_NUM</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">:</span>
    r<span class="token string">'\d+'</span>
    t<span class="token punctuation">.</span>value <span class="token operator">=</span> int<span class="token punctuation">(</span>t<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token keyword">return</span> t

<span class="token comment" spellcheck="true"># error handler</span>
<span class="token keyword">def</span> <span class="token function">t_error</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Bad character: {!r}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>t<span class="token punctuation">.</span>value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    t<span class="token punctuation">.</span>skip<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># bulid the lexer</span>
lexer <span class="token operator">=</span> lex<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># Grammer rules and handler functions</span>
<span class="token keyword">def</span> <span class="token function">p_expr</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    expr : expr PLUS term
        | expr MINUS term
    '''</span>
    <span class="token keyword">if</span> p<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'+'</span><span class="token punctuation">:</span>
        p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> p<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
    <span class="token keyword">elif</span> p<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'-'</span><span class="token punctuation">:</span>
        p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> p<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">p_expr_term</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    expr : term
    '''</span>
    p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">p_term</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    term : term TIMES factor
        | term DIVIDE factor
    '''</span>
    <span class="token keyword">if</span> p<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'*'</span><span class="token punctuation">:</span>
        p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">*</span>p<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
    <span class="token keyword">elif</span> p<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'/'</span><span class="token punctuation">:</span>
        p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">/</span>p<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">p_term_factor</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    term : factor
    '''</span>
    p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">p_factor</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    factor : NUM
    '''</span>
    p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">p_factor_group</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    factor : LPAREN expr RPAREN
    '''</span>
    p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">p_error</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Syntax error'</span><span class="token punctuation">)</span>

parser <span class="token operator">=</span> yacc<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>parser<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>parser<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'2+3'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>parser<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'2*(3+4) + 5'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E5%AD%97%E8%8A%82%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8A%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C">字节字符串上的字符串操作</h3>

<div class="code-chunk" data-id="code-chunk-id-65" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token comment" spellcheck="true"># 字节字符串同样也支持大部分和文本字符串一样的内置操作</span>
data <span class="token operator">=</span> b<span class="token string">'Hello World'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span>b<span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>b<span class="token string">'Hello'</span><span class="token punctuation">,</span> b<span class="token string">'Hello Cruel'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 这些操作同样适用于字节数组</span>
data <span class="token operator">=</span> bytearray<span class="token punctuation">(</span>b<span class="token string">'Hello World'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span>b<span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>b<span class="token string">'Hello'</span><span class="token punctuation">,</span> b<span class="token string">'Hello Curel'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 可以用正则表达式匹配字节字符串</span>
data <span class="token operator">=</span> b<span class="token string">'FOO:BAR,SPAM'</span>
<span class="token keyword">import</span> re
<span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>split<span class="token punctuation">(</span>b<span class="token string">'[:,]+'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 大多数情况下，在文本字符串上的操作均可以用于字节字符串</span>
<span class="token comment" spellcheck="true"># 不同点1：字节字符串索引操作返回整数而不是单个字符</span>
a <span class="token operator">=</span> <span class="token string">'Hello World'</span>
b <span class="token operator">=</span> b<span class="token string">'Hello World'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'{a[0]} , 0x{b[0]:x}'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 不同点2：打印出来为 b'...'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'ascii'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 不同点3：不能格式化</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token string">'{:x}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'catch a except'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 实现的方式</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'{:x}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'ascii'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>一些程序员为了提升程序执行的速度，会倾向于使用字节字符串而不是我蹦字符串，尽管操作字节字符串确实会比文本更加高效（因为厂里文本固有的Unicode相关开销），但通常会导致代码杂乱。你会经常发现字节字符串并不能和Python的其他部分工作，需要手动 encode/decode 操作。</p>
<h2 class="mume-header" id="%E6%95%B0%E5%AD%97%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4">数字日期和时间</h2>

<p>在Python中执行整数和浮点数的数字运算是很简单。如果你需要执行分数、数组或者是日期和时间的运算，就需要做更多工作。</p>
<h3 class="mume-header" id="%E6%95%B0%E5%AD%97%E7%9A%84%E5%9B%9B%E8%88%8D%E4%BA%94%E5%85%A5">数字的四舍五入</h3>

<div class="code-chunk" data-id="code-chunk-id-66" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>round<span class="token punctuation">(</span><span class="token number">1.24</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 当一个值更好在两个边界，round函数返回离它最近的偶数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>round<span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>round<span class="token punctuation">(</span><span class="token number">2.5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># round(number [,ndigits]), ndigits可以为负，表示小数前几位</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>round<span class="token punctuation">(</span><span class="token number">12345</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 如果仅仅是为了显示，用str.format</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'{:-.0f}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 不要试着去舍入浮点来“修正”表面上看起来正确的问题</span>
a <span class="token operator">=</span> <span class="token number">2.1</span>
b <span class="token operator">=</span> <span class="token number">4.2</span>
c <span class="token operator">=</span> a <span class="token operator">+</span> b
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
c <span class="token operator">=</span> round<span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>对于大多数使用到浮点的程序，没有必要也不推荐怎么做，尽管在计算的时候回有一点点小的误差，但是这些小的误差是能被理解和容忍的。如果不能允许这些小误差（比如涉及到金融领域），就需要考虑使用 decimal 模块了。</p>
<h3 class="mume-header" id="%E6%89%A7%E8%A1%8C%E7%B2%BE%E7%A1%AE%E7%9A%84%E6%B5%AE%E7%82%B9%E6%95%B0%E8%BF%90%E7%AE%97">执行精确的浮点数运算</h3>

<p>浮点数的一个普遍问题是它们不能精确表示十进制数，并且即使是最简单的数学运算也会产生小的误差：</p>
<div class="code-chunk" data-id="code-chunk-id-67" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">a <span class="token operator">=</span> <span class="token number">0.2</span>
b <span class="token operator">=</span> <span class="token number">0.1</span>
c <span class="token operator">=</span> a <span class="token operator">+</span> b
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token operator">==</span><span class="token number">0.3</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 正确的判断</span>
<span class="token keyword">import</span> math
<span class="token keyword">print</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>isclose<span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>这些错误是有底层CPU和IEEE754标准通过自己的浮点单元去执行算数时的特征。由于Python的浮点数据类型使用底层表示存储数据，因此你没办法去避免这样的误差。</p>
<p>如果你想更加精确（并能容忍一定的性能损耗），你可以使用decimal模块：</p>
<div class="code-chunk" data-id="code-chunk-id-68" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">from</span> decimal <span class="token keyword">import</span> Decimal
<span class="token keyword">from</span> decimal <span class="token keyword">import</span> localcontext
a <span class="token operator">=</span> Decimal<span class="token punctuation">(</span><span class="token string">'4.2'</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> Decimal<span class="token punctuation">(</span><span class="token string">'2.1'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">+</span>b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">+</span>b<span class="token operator">==</span>Decimal<span class="token punctuation">(</span><span class="token string">'6.3'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> Decimal<span class="token punctuation">(</span><span class="token string">'1.3'</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> Decimal<span class="token punctuation">(</span><span class="token string">'1.7'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">/</span>b<span class="token punctuation">)</span>
<span class="token keyword">with</span> localcontext<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> ctx<span class="token punctuation">:</span>
    ctx<span class="token punctuation">.</span>prec <span class="token operator">=</span> <span class="token number">3</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">/</span>b<span class="token punctuation">)</span>
<span class="token keyword">with</span> localcontext<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> ctx<span class="token punctuation">:</span>
    ctx<span class="token punctuation">.</span>prec <span class="token operator">=</span> <span class="token number">7</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">/</span>b<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>decimal 模块实现了 IBM 的“通用小数运算规范”。</p>
<p>Python新手会倾向于使用decimal模块来处理浮点数的精确运算。然而，先理解你的应用程序目的是非常重要的。如果你是在做科学计算或者工程领域的计算、电脑绘图或者是科学领域的大多数运算，那么使用普通的浮点类型是比较普遍的用法。其中的一个原因是，在真实的世界中很少会要求精确到普通浮点数能提供的17位精度。第二个原因是，原生的浮点数计算要快的多。</p>
<p>误差的产生：</p>
<div class="code-chunk" data-id="code-chunk-id-69" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">a <span class="token operator">=</span> <span class="token number">1.23e+18</span>
b <span class="token operator">=</span> <span class="token number">1</span>
c <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1.23e+18</span>
<span class="token comment" spellcheck="true"># 1 被“丢失了”</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">+</span>b<span class="token operator">+</span>c<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 使用 math.fsum 进行精确运算</span>
<span class="token keyword">from</span> math <span class="token keyword">import</span> fsum
<span class="token keyword">print</span><span class="token punctuation">(</span>fsum<span class="token punctuation">(</span><span class="token punctuation">[</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E6%95%B0%E5%AD%97%E7%9A%84%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%BE%93%E5%87%BA">数字的格式化输出</h3>

<div class="code-chunk" data-id="code-chunk-id-70" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">x <span class="token operator">=</span> <span class="token number">1234.56789</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"'{x:.2f}'"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"'{x:>10.1f}'"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"'{x:&lt;10.1f}'"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"'{x:^10.1f}'"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"'{x:,}'"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"'{x:e}'"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"'{x:.3E}'"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 同时制定宽度和精度的一般形式是：[&lt;>^]?width[,]?(.digits)?</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"'{x:,.2f}'"</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#上述方法同样使用与Decimal</span>
<span class="token keyword">from</span> decimal <span class="token keyword">import</span> Decimal
x <span class="token operator">=</span> Decimal<span class="token punctuation">(</span><span class="token string">'1234.56789'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'{x:*^15,.3f}'</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E4%BA%8C%E5%85%AB%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E8%A1%A8%E7%A4%BA%E6%95%B4%E6%95%B0">二八十六进制表示整数</h3>

<div class="code-chunk" data-id="code-chunk-id-71" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">x <span class="token operator">=</span> <span class="token number">1234</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>bin<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'{x:b}'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>oct<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'{x:o}'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>hex<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'{x:x}'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 整数是有符号的</span>
x <span class="token operator">=</span> <span class="token operator">-</span>x
<span class="token keyword">print</span><span class="token punctuation">(</span>bin<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'{x:b}'</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 显示负数对应的无符号二进制表示</span>
<span class="token comment" spellcheck="true"># 32 位对应的无符号表示</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'{2**32+x:b}'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'{2**32+x:x}'</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 将不同进制字符串转换为整数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>int<span class="token punctuation">(</span><span class="token string">'4d2'</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>int<span class="token punctuation">(</span><span class="token string">'10011010010'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E5%AD%97%E8%8A%82%E5%88%B0%E5%A4%A7%E6%95%B4%E6%95%B0%E7%9A%84%E6%89%93%E5%8C%85%E4%B8%8E%E8%A7%A3%E5%8C%85">字节到大整数的打包与解包</h3>

<div class="code-chunk" data-id="code-chunk-id-72" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">data <span class="token operator">=</span> b<span class="token string">'\x00\x124V\x00x\x90\xab\x00\xcd\xef\x01\x00#\x004'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>len<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"{int.from_bytes(data, 'little'):x}"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"{int.from_bytes(data, 'big'):x}"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>int<span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">'big'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

x <span class="token operator">=</span> <span class="token number">94522842520747284487117727783387188</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>to_bytes<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token string">'big'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>大整数和字节字符串之间的转换操作并不常见，然而，在一些应用领域，比如密码学或网络，有时候也会出现。</p>
<h3 class="mume-header" id="%E5%A4%8D%E6%95%B0">复数</h3>

<div class="code-chunk" data-id="code-chunk-id-73" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">a <span class="token operator">=</span> complex<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">+</span><span class="token number">4j</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">==</span>b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>real<span class="token punctuation">,</span> a<span class="token punctuation">.</span>imag<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 共轭复数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>conjugate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>常见的运算可以工作：</p>
<div class="code-chunk" data-id="code-chunk-id-74" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">a <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">+</span><span class="token number">4j</span>
b <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">-</span><span class="token number">3j</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">+</span>b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">-</span>b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">*</span>b<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">/</span>b<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>Python 中大部分与数字相关的模块都能处理复数，比如如果使用numpy，可以很容易构造一个复数数组并在这个数组上执行各种操作：</p>
<div class="code-chunk" data-id="code-chunk-id-75" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
a <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">3j</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">5j</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token operator">-</span><span class="token number">7j</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token operator">+</span><span class="token number">9j</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>Python的标准数学函数模块 math 不能产生复数值，因此你的代码不会出现复数返回值：</p>
<div class="code-chunk" data-id="code-chunk-id-76" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">import</span> math
<span class="token keyword">print</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>但是可以使用 cmath 模块：</p>
<div class="code-chunk" data-id="code-chunk-id-77" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">import</span> cmath
<span class="token keyword">print</span><span class="token punctuation">(</span>cmath<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 或者是 ** 运算符</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token punctuation">.</span><span class="token number">5</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E6%97%A0%E7%A9%B7%E5%A4%A7%E4%B8%8Enan">无穷大与NaN</h3>

<p>Python并没有特殊的语法来表示正无穷、负无穷、NaN(非数字)的浮点数，但是可以使用<code>float()</code>来创建它们：</p>
<div class="code-chunk" data-id="code-chunk-id-78" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">import</span> math
a <span class="token operator">=</span> float<span class="token punctuation">(</span><span class="token string">'inf'</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> float<span class="token punctuation">(</span><span class="token string">'-inf'</span><span class="token punctuation">)</span>
c <span class="token operator">=</span> float<span class="token punctuation">(</span><span class="token string">'nan'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># inf</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>isinf<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># True</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># -inf</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>isinf<span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># True</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># nan</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>isnan<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># True</span>
<span class="token comment" spellcheck="true"># 无穷大的运算</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">+</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># inf</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">*</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># inf</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token operator">/</span>a<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 0.0</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">/</span>a<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># nan</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">+</span>b<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># nan</span>
<span class="token comment" spellcheck="true"># NaN会在所有操作中传播</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># nan</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c <span class="token operator">/</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># nan</span>
<span class="token comment" spellcheck="true"># 两个NaN值不相等</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token operator">==</span>float<span class="token punctuation">(</span><span class="token string">'nan'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># False</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E5%88%86%E6%95%B0%E8%BF%90%E7%AE%97">分数运算</h3>

<p><code>fractions</code> 模块可以被用来执行包含分数的数学运算，比如：</p>
<div class="code-chunk" data-id="code-chunk-id-79" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">from</span> fractions <span class="token keyword">import</span> Fraction
a <span class="token operator">=</span> Fraction<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> Fraction<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">+</span>b<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 27/16</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">*</span>b<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 35/64</span>

<span class="token comment" spellcheck="true"># 获取 numerator / denominator</span>
c <span class="token operator">=</span> a <span class="token operator">*</span> b
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>numerator<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 35</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>denominator<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 64</span>

<span class="token comment" spellcheck="true"># 转换为小数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>float<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 0.546875</span>

<span class="token comment" spellcheck="true"># 限制分母大小</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>limit_denominator<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 4/7</span>

<span class="token comment" spellcheck="true"># 小数转换为分数</span>
x <span class="token operator">=</span> <span class="token number">3.75</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Fraction<span class="token punctuation">(</span><span class="token operator">*</span>x<span class="token punctuation">.</span>as_integer_ratio<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>在大多数程序中一般不会出现分数的计算问题，但是有时候还是需要用到的。比如在一个允许接收分数形式的测试单位以分数形式执行运算的程序中，直接使用分数可以减小手动转换为小数或浮点数的工作。</p>
<h3 class="mume-header" id="%E5%A4%A7%E5%9E%8B%E6%95%B0%E7%BB%84%E8%BF%90%E7%AE%97">大型数组运算</h3>

<p>涉及到数组的重量级运算操作，可以使用NumPy库。NumPy的一个主要特征是它会给Python提供一个数组对象，相比于标准的Python列表而言，更适合用来做数学运算。</p>
<p>传统的 list 操作：</p>
<div class="code-chunk" data-id="20180408214923" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd id=&amp;amp;quot;20180408214923&amp;amp;quot;}" class="language-python"><span class="token comment" spellcheck="true"># Python list</span>
x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>
y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="code-chunk-id-81" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd continue=&amp;amp;quot;20180408214923&amp;amp;quot;}" class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="code-chunk-id-82" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd continue=&amp;amp;quot;20180408214923&amp;amp;quot;}" class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="code-chunk-id-83" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd continue=&amp;amp;quot;20180408214923&amp;amp;quot;}" class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token operator">+</span>y<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>Numpy 库的操作：</p>
<div class="code-chunk" data-id="20180408215711" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd id=&amp;amp;quot;20180408215711&amp;amp;quot;}" class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
ax <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ay <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="code-chunk-id-85" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd continue=&amp;amp;quot;20180408215711&amp;amp;quot;}" class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>ax<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="code-chunk-id-86" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd continue=&amp;amp;quot;20180408215711&amp;amp;quot;}" class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>ax<span class="token operator">+</span><span class="token number">10</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="code-chunk-id-87" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd continue=&amp;amp;quot;20180408215711&amp;amp;quot;}" class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>ax<span class="token operator">+</span>ay<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="code-chunk-id-88" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd continue=&amp;amp;quot;20180408215711&amp;amp;quot;}" class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>ax<span class="token operator">*</span>ay<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>如上所示，两种方案中数组的基本数学运算结果并不相同。特别地，NumPy中的标量运算（比如 ax*2 或 ax+10）会作用在每一个元素上，另外当两个操作都是数组的时候执行元素对等位置计算，并最终生成一个新的数组。</p>
<p>对这个数组中所有元素同时执行数学运算可以使得作用在数组上的函数简单而快速。比如，你想计算多项式的值：</p>
<div class="code-chunk" data-id="code-chunk-id-89" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd continue=&amp;amp;quot;20180408215711&amp;amp;quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token number">3</span><span class="token operator">*</span>x<span class="token operator">**</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token operator">*</span>x <span class="token operator">+</span> <span class="token number">7</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">(</span>ax<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>NumPy还为数组操作提供了大量的通用函数，这些函数可以作为math模块中的替代，比如：</p>
<div class="code-chunk" data-id="code-chunk-id-90" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd continue=&amp;amp;quot;20180408215711&amp;amp;quot;}" class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>ax<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>ax<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>使用这些通用函数要比循环数组并使用 math 模块中的函数执行计算要快得多。因此只要有可能，尽量选择 NumPy 的数组方案。</p>
<p>底层实现中，NumPy 数组使用了 C 或者 Fortran 语言的机制分配内存。也就是说，它们是一个非常大的连续的并且有相同类型数据组成的内存区域。所以，你可以构造一个比普通 Python 列表大得多的数组，比如，你构建一个10000*10000的浮点数二维数组：</p>
<div class="code-chunk" data-id="20180408221348" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd id=&amp;amp;quot;20180408221348&amp;amp;quot;}" class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
grid <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>float<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="code-chunk-id-92" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd continue=&amp;amp;quot;20180408221348&amp;amp;quot;}" class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>grid<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>所有普通操作都会作用在所有元素上：</p>
<div class="code-chunk" data-id="20180408221653" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd continue=&amp;amp;quot;20180408221348&amp;amp;quot; id=&amp;amp;quot;20180408221653&amp;amp;quot;}" class="language-python">grid <span class="token operator">+=</span> <span class="token number">10</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="code-chunk-id-94" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd continue=&amp;amp;quot;20180408221653&amp;amp;quot;}" class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>grid<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="code-chunk-id-95" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd continue=&amp;amp;quot;20180408221653&amp;amp;quot;}" class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>grid<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>关于 NumPy ，有一点需要特别地注意，那就是他扩展了Python列表的索引功能：</p>
<div class="code-chunk" data-id="code-chunk-id-96" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
a <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">'\n'</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">'\n'</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">'\n'</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>
a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">10</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">'\n'</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">+</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">103</span><span class="token punctuation">]</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">'\n'</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">101</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">102</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">'\n'</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>a<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>NumPy 是 Python 领域中很多科学与工程库的基础，同时也是被广泛使用的最大最复杂的模块。</p>
<h3 class="mume-header" id="%E7%9F%A9%E9%98%B5%E4%B8%8E%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E8%BF%90%E7%AE%97">矩阵与线性代数运算</h3>

<p>你需要执行矩阵和线性代数运算，比如矩阵乘法、寻找行列式、求解线性方程组等等。</p>
<p>NumPy 库有一个矩阵对象可以用来解决这个问题。矩阵类似于3.9小节中数组对象，但是遵循线性代数的计算规则：</p>
<div class="code-chunk" data-id="code-chunk-id-97" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
m <span class="token operator">=</span> np<span class="token punctuation">.</span>matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">'\n'</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>T<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">'\n'</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 返回矩阵的逆</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>I<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">'\n'</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># m·m.I = identity matrix</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token operator">*</span>m<span class="token punctuation">.</span>I<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">'\n'</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>

v <span class="token operator">=</span> np<span class="token punctuation">.</span>matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">'\n'</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token operator">*</span>v<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>可以在 <code>numpy.linalg</code>子包中找到更多的操作函数：</p>
<div class="code-chunk" data-id="code-chunk-id-98" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token comment" spellcheck="true"># determinant 矩阵行列式的值</span>
m <span class="token operator">=</span> np<span class="token punctuation">.</span>matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
v <span class="token operator">=</span> np<span class="token punctuation">.</span>matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>det<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">'\n'</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># eigenvalues 特征值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>eigvals<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">'\n'</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 解方程 mx=v</span>
x <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>solve<span class="token punctuation">(</span>m<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">'\n'</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token operator">*</span>x<span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">'\n'</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E9%9A%8F%E6%9C%BA%E9%80%89%E6%8B%A9">随机选择</h3>

<p>从一个序列中随机抽取若干个元素，或者想生成几个随机数：</p>
<div class="code-chunk" data-id="code-chunk-id-99" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">import</span> random
values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span>
<span class="token comment" spellcheck="true"># 随机选出 list 中的一个元素</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 随机选出 list 中的若干个元素</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>values<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 打乱序列中元素的顺序</span>
random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>values<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 随机生成整数，范围为 [0, 100] 的闭区间</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 随机生成 0~1 范围内的浮点数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 以等概率均匀分布生成 0~1 的随机数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 以均值为0，标准差为1，生成高斯分布</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span>gauss<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 获取 N 为随机位（二进制）的整数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'{random.getrandbits(200):x}'</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>random 模块使用 Mersenne Twister 算法来计算生成随机数，这是一个确定性算法，但你可以通过 random.seed() 函数修改初始化种子。</p>
<h3 class="mume-header" id="%E5%9F%BA%E6%9C%AC%E6%97%A5%E6%9C%9F%E4%B8%8E%E6%97%B6%E9%97%B4%E8%BD%AC%E6%8D%A2">基本日期与时间转换</h3>

<p>与日期、时间相关的模块为 <code>datetime</code>。其子模块 <code>timedelta</code> 用于表示时间间隔：</p>
<div class="code-chunk" data-id="code-chunk-id-100" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token comment" spellcheck="true"># timedelta 表示一段时间间隔</span>
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> timedelta
a <span class="token operator">=</span> timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> hours<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> timedelta<span class="token punctuation">(</span>hours<span class="token operator">=</span><span class="token number">17.5</span><span class="token punctuation">)</span>
c <span class="token operator">=</span> a<span class="token operator">+</span>b
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>days<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>seconds<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>seconds<span class="token operator">/</span><span class="token number">3600</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>total_seconds<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3600</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>如果你想表示指定的日期和时间，先创建一个 datetime 实例，然后使用标准的数学运算来操作它们：</p>
<div class="code-chunk" data-id="code-chunk-id-101" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> timedelta
a <span class="token operator">=</span> datetime<span class="token punctuation">(</span><span class="token number">2018</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">49</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># datetime 和 timedelta 的运算</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">+</span>timedelta<span class="token punctuation">(</span>hours<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> minutes<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> datetime<span class="token punctuation">(</span><span class="token number">2012</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># datetime 之间的运算</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">-</span>b<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 获取当前时间</span>
now <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>注意：datetime 会自动处理闰年：</p>
<div class="code-chunk" data-id="code-chunk-id-102" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
a <span class="token operator">=</span> datetime<span class="token punctuation">(</span><span class="token number">2012</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> datetime<span class="token punctuation">(</span><span class="token number">2012</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">-</span>b<span class="token punctuation">)</span>
a <span class="token operator">=</span> datetime<span class="token punctuation">(</span><span class="token number">2100</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> datetime<span class="token punctuation">(</span><span class="token number">2100</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">-</span>b<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>对于大多数基本的日期和时间处理问题，<code>datetime</code> 模块已经足够了，如果你需要执行更加复杂的日期操作，如处理时区、节假日计算等，可以考虑使用 <code>dateutil</code> 模块。</p>
<h3 class="mume-header" id="%E8%AE%A1%E7%AE%97%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E5%91%A8%E4%BA%94%E7%9A%84%E6%97%A5%E6%9C%9F">计算最后一个周五的日期</h3>

<div class="code-chunk" data-id="code-chunk-id-103" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime<span class="token punctuation">,</span> timedelta
weekdays <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Monday'</span><span class="token punctuation">,</span> <span class="token string">'Tuesday'</span><span class="token punctuation">,</span> <span class="token string">'Wednesday'</span><span class="token punctuation">,</span>
    <span class="token string">'Thursday'</span><span class="token punctuation">,</span> <span class="token string">'Friday'</span><span class="token punctuation">,</span> <span class="token string">'Saturday'</span><span class="token punctuation">,</span> <span class="token string">'Sunday'</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">get_previous_byday</span><span class="token punctuation">(</span>dayname<span class="token punctuation">,</span> start_date<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> start_date<span class="token operator">==</span>None<span class="token punctuation">:</span>
        start_date <span class="token operator">=</span> datetime<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span>
    day_delta <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token operator">+</span>start_date<span class="token punctuation">.</span>weekday<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span>
        weekdays<span class="token punctuation">.</span>index<span class="token punctuation">(</span>dayname<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">7</span>
    day_delta <span class="token operator">=</span> day_delta <span class="token keyword">if</span> day_delta <span class="token keyword">else</span> <span class="token number">7</span>
    <span class="token keyword">return</span> start_date<span class="token operator">-</span>timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span>day_delta<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>get_previous_byday<span class="token punctuation">(</span><span class="token string">'Sunday'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 2016年最后一个星期五</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>get_previous_byday<span class="token punctuation">(</span><span class="token string">'Friday'</span><span class="token punctuation">,</span> datetime<span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>查看真实情况：</p>
<div class="code-chunk" data-id="code-chunk-id-104" data-cmd="/bin/zsh"><div class="input-div"><pre data-role="codeBlock" data-info="sh {code_chunk_offset=1, cmd=&amp;amp;quot;&amp;amp;#x2F;bin&amp;amp;#x2F;zsh&amp;amp;quot;}" class="language-bash"><span class="token function">cal</span> 12 2016
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>可见2016年最后一个周五真的是：2016-12-30。</p>
<p>如果要执行大量的日期计算，最好使用模块 <code>dateutil</code>。</p>
<div class="code-chunk" data-id="code-chunk-id-105" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">from</span> dateutil<span class="token punctuation">.</span>relativedelta <span class="token keyword">import</span> relativedelta
<span class="token keyword">from</span> dateutil<span class="token punctuation">.</span>rrule <span class="token keyword">import</span> <span class="token operator">*</span>
d <span class="token operator">=</span> datetime<span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token operator">+</span>relativedelta<span class="token punctuation">(</span>weekday<span class="token operator">=</span>FR<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># 修改day属性</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>day<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>calendar 用于与日历相关的信息处理：</p>
<div class="code-chunk" data-id="code-chunk-id-106" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">import</span> calendar
<span class="token comment" spellcheck="true"># 返回 2017-2-1 星期几，共多少天</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>calendar<span class="token punctuation">.</span>monthrange<span class="token punctuation">(</span><span class="token number">2017</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 2表示周三</span>
<span class="token comment" spellcheck="true"># 返回 2016-2-1 星期几，共多少天</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>calendar<span class="token punctuation">.</span>monthrange<span class="token punctuation">(</span><span class="token number">2016</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 0表示周一</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%8D%A2%E4%B8%BA%E6%97%B6%E9%97%B4">字符串转换为时间</h3>

<div class="code-chunk" data-id="code-chunk-id-107" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
text <span class="token operator">=</span> <span class="token string">'2018-4-9'</span>
y <span class="token operator">=</span> datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token string">'%A %B %d, %Y'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>注意：<code>strptime</code>的性能非常差，如果知道解析格式，最好自己写：</p>
<div class="code-chunk" data-id="code-chunk-id-108" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">def</span> <span class="token function">strptime</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    year_s<span class="token punctuation">,</span> month_s<span class="token punctuation">,</span> day_s <span class="token operator">=</span> s<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> datetime<span class="token punctuation">(</span>int<span class="token punctuation">(</span>year_s<span class="token punctuation">)</span><span class="token punctuation">,</span> int<span class="token punctuation">(</span>month_s<span class="token punctuation">)</span><span class="token punctuation">,</span>int<span class="token punctuation">(</span>day_s<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>strptime<span class="token punctuation">(</span><span class="token string">'2018-4-9'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>经过测试，自定义的函数性能比<code>datetime.strptime</code>快7倍，尽量使用自定义的时间解析。</p>
<h2 class="mume-header" id="%E5%87%BD%E6%95%B0">函数</h2>

<p>使用 <code>def</code> 语句定义函数是所有程序的基础。本章的目的是讲解一些更加高级和不常见的函数定义和使用模式。涉及到的内容包括默认参数、任意数量参数、强制关键字参数、注解和闭包。另外一些高级的控制流和利用回调函数传递数据的技术也会在这里讲解到。</p>
<h3 class="mume-header" id="%E5%8F%AF%E6%8E%A5%E5%8F%97%E4%BB%BB%E6%84%8F%E6%95%B0%E9%87%8F%E5%8F%82%E6%95%B0%E7%9A%84%E5%87%BD%E6%95%B0">可接受任意数量参数的函数</h3>

<div class="code-chunk" data-id="code-chunk-id-109" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token comment" spellcheck="true"># 计算平均值，参数数量不确定，至少为 1 个</span>
<span class="token keyword">def</span> <span class="token function">avg</span><span class="token punctuation">(</span>first<span class="token punctuation">,</span> <span class="token operator">*</span>rest<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>first <span class="token operator">+</span> sum<span class="token punctuation">(</span>rest<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">+</span>len<span class="token punctuation">(</span>rest<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>avg<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>avg<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>在这个例子中， <code>rest</code> 形参是所有其他位置参数组成的元组。然后我们在代码中把它当成了一个序列来进行后续的计算。</p>
<p>为了接受任意数量的关键字参数，使用一个以 ** 开头的参数:</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">import</span> html
<span class="token keyword">def</span> <span class="token function">make_element</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token operator">**</span>attrs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    keyvalues <span class="token operator">=</span> <span class="token punctuation">[</span>f<span class="token string">' {k}="{v}"'</span> <span class="token keyword">for</span> k<span class="token punctuation">,</span>v <span class="token keyword">in</span> attrs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>f<span class="token string">'&lt;{name}{"".join(keyvalues)}>'</span>
     f<span class="token string">'{html.escape(value)}&lt;/{name}>'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>make_element<span class="token punctuation">(</span><span class="token string">'item'</span><span class="token punctuation">,</span> <span class="token string">'Albatross'</span><span class="token punctuation">,</span> 
    size<span class="token operator">=</span><span class="token string">'large'</span><span class="token punctuation">,</span> quantity<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>make_element<span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'&lt;spam>'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><pre data-role="codeBlock" data-info="" class="language-"><code>&lt;item size=&quot;large&quot; quantity=&quot;6&quot;&gt;Albatross&lt;/item&gt;
&lt;p&gt;&amp;lt;spam&amp;gt;&lt;/p&gt;
</code></pre><p>如果同时希望接收任意数量的位置参数和关键字参数，可以同时使用 * 和 ** 。</p>
<div class="code-chunk" data-id="code-chunk-id-110" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">anyargs</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># a tuple</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>kwargs<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># a dict</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p><strong>注意：</strong> 一个 * 参数只能出现在函数定义中最后一个位置参数后面，而 ** 参数只能出现在最后一个参数，有一点需要注意的是，在 * 参数后面仍然可以定义其他参数。</p>
<div class="code-chunk" data-id="code-chunk-id-111" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
<span class="token keyword">def</span> <span class="token function">b</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>这种参数就是我们所说的强制关键字参数。</p>
<h3 class="mume-header" id="%E5%8F%AA%E6%8E%A5%E5%8F%97%E5%85%B3%E9%94%AE%E5%AD%97%E5%8F%82%E6%95%B0%E7%9A%84%E5%87%BD%E6%95%B0">只接受关键字参数的函数</h3>

<p>如果你希望函数的某些参数强制使用关键字参数传递，只需要将强制关键字参数放在某个 * 参数或者单个 * 后面就能达到这种效果，比如：</p>
<div class="code-chunk" data-id="20180411092137" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd id=&amp;amp;quot;20180411092137&amp;amp;quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">recv</span><span class="token punctuation">(</span>maxsize<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> block<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">'Receives a message'</span>
    <span class="token keyword">pass</span>
<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
    <span class="token keyword">except</span> TypeError<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Catch TypeError'</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'No Error'</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="code-chunk-id-113" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd continue=&amp;amp;quot;20180411092137&amp;amp;quot;}" class="language-python">test<span class="token punctuation">(</span>recv<span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># recv(1024, True)</span>
test<span class="token punctuation">(</span>recv<span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> block<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># recv(1024, block=True)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>利用这种技术，我们还能在接受任意多个位置参数的函数中指定关键字参数，比如:</p>
<div class="code-chunk" data-id="code-chunk-id-114" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">minimum</span><span class="token punctuation">(</span><span class="token operator">*</span>values<span class="token punctuation">,</span> clip<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>
    m <span class="token operator">=</span> min<span class="token punctuation">(</span>values<span class="token punctuation">)</span>
    <span class="token keyword">if</span> clip <span class="token operator">!=</span> None<span class="token punctuation">:</span>
        m <span class="token operator">=</span> clip <span class="token keyword">if</span> clip<span class="token operator">></span>m <span class="token keyword">else</span> m
    <span class="token keyword">return</span> m
<span class="token keyword">print</span><span class="token punctuation">(</span>minimum<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>minimum<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span>clip<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>很多情况下，使用强制关键字参数会比使用位置参数表意更加清晰，程序也更加具有可读性：</p>
<pre data-role="codeBlock" data-info="python" class="language-python">msg <span class="token operator">=</span> recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
</pre><p>如果调用者对<code>recv</code>函数不是很熟悉，那他肯定不明白那个False参数到底用来干嘛，但是，如果代码编程下面的样子的话就清楚多了：</p>
<pre data-role="codeBlock" data-info="python" class="language-python">msg <span class="token operator">=</span> recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> block<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</pre><p>另外，使用强制关键字参数也比使用 **kwargs 参数更好，因为在使用函数 help 时的输出也更加容易理解：</p>
<div class="code-chunk" data-id="code-chunk-id-115" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd continue=&amp;amp;quot;20180411092137&amp;amp;quot;}" class="language-python">help<span class="token punctuation">(</span>recv<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E7%BB%99%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E5%A2%9E%E5%8A%A0%E5%85%83%E4%BF%A1%E6%81%AF">给函数参数增加元信息</h3>

<p>你写好了一个函数，然后想为这个函数的参数增加一些额外的信息，这样的话，其他使用者就能清楚地知道这个函数应该怎么用，使用函数参数注解是一个很好的办法，它能够提示程序员应该怎样使用这个函数，如下面是一个被注解了的函数：</p>
<div class="code-chunk" data-id="code-chunk-id-116" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span>int<span class="token punctuation">,</span> y<span class="token punctuation">:</span>int<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> int<span class="token punctuation">:</span>
    <span class="token keyword">return</span> x<span class="token operator">+</span>y
help<span class="token punctuation">(</span>add<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>Python解释器不会对这些注释添加任何的语义。它们不会被类型检查，运行时跟没有加注解之前的效果也没有任何差距。然而，对于那些阅读源代码的人来讲就非常有帮助。第三方工具和框架可能会对这些注释添加语义，同时它们也会出现在文档中。</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span>int<span class="token punctuation">,</span> y<span class="token punctuation">:</span>int<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> int<span class="token punctuation">:</span>
    <span class="token keyword">return</span> x<span class="token operator">+</span>y
<span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">.</span>__annotations__<span class="token punctuation">)</span>
</pre><pre data-role="codeBlock" data-info="" class="language-"><code>{&apos;x&apos;: &lt;class &apos;int&apos;&gt;, &apos;y&apos;: &lt;class &apos;int&apos;&gt;, &apos;return&apos;: &lt;class &apos;int&apos;&gt;}
</code></pre><h3 class="mume-header" id="%E8%BF%94%E5%9B%9E%E5%A4%9A%E4%B8%AA%E5%80%BC%E7%9A%84%E5%87%BD%E6%95%B0">返回多个值的函数</h3>

<p>你希望构造一个可以返回多个值的函数。</p>
<p>为了能返回多个值，函数直接 return 一个元组就可以了，例如：</p>
<div class="code-chunk" data-id="code-chunk-id-117" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">myfun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span>
a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c <span class="token operator">=</span> myfun<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> myfun<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>尽管 <code>myfun()</code> 看上去返回了多个值，其实是先创建了一个元组，然后返回的。</p>
<div class="code-chunk" data-id="code-chunk-id-118" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">myfun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c <span class="token operator">=</span> myfun<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span>
d <span class="token operator">=</span> myfun<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>这个语法看上去比较奇怪，实际上我们使用的是逗号生成一个元组，而不是括号：</p>
<div class="code-chunk" data-id="code-chunk-id-119" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E5%AE%9A%E4%B9%89%E6%9C%89%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0%E7%9A%84%E5%87%BD%E6%95%B0">定义有默认参数的函数</h3>

<p>定义一个函数或方法，它的一个或多个参数使可选的，并且有一个默认值：</p>
<div class="code-chunk" data-id="code-chunk-id-120" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">spam</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
spam<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
spam<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>如果默认参数是一个可修改的容器，比如列表、集合或字典，可以使用 None 作为默认值</p>
<div class="code-chunk" data-id="code-chunk-id-121" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">spam</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">:</span>list<span class="token operator">=</span>None<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> list<span class="token punctuation">:</span>
    b <span class="token operator">=</span> b <span class="token keyword">if</span> b <span class="token keyword">is</span> <span class="token operator">not</span> None <span class="token keyword">else</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span>b
help<span class="token punctuation">(</span>spam<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>如果你不想提供一个默认值，而是想仅仅测试一下某个默认参数是不是有参数传递进来，可以像下面这样写：</p>
<div class="code-chunk" data-id="code-chunk-id-122" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">_no_value <span class="token operator">=</span> object<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">spam</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token operator">=</span>_no_value<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> b <span class="token keyword">is</span> _no_value<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'No b value supplied'</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'b value has supplied'</span><span class="token punctuation">)</span>
spam<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
spam<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
spam<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> None<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>可以看出，传递一个 None 值和不传值是两种不同的情况。</p>
<p>默认参数的值仅仅在函数定义的时候赋值一次：</p>
<div class="code-chunk" data-id="code-chunk-id-123" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">x <span class="token operator">=</span> <span class="token number">42</span>
<span class="token keyword">def</span> <span class="token function">spam</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token operator">=</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
spam<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> <span class="token number">43</span>
spam<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>注意，当我们改变 <code>x</code> 的值时，对默认参数值并没有影响，这是因为在函数定义时就已经确定了它的默认值。</p>
<p>其次，默认参数的值应该是不可变的对象，比如 None、True、False、数字或字符串，特别不要写类似：<code>def spam(a,b=[])</code>的代码。如果这样做了，当默认值在其他地方被修改后，你将会遇到各种麻烦以及安全问题：</p>
<div class="code-chunk" data-id="code-chunk-id-124" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">spam</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
    <span class="token keyword">return</span> b
x <span class="token operator">=</span> spam<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
x<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">)</span>
spam<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>这种结果不是你想要的，为了避免这种情况的发生，最好是将默认值设为 None，然后在函数里面检查它：</p>
<div class="code-chunk" data-id="code-chunk-id-125" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">spam</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>
    b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">if</span> b <span class="token keyword">is</span> None <span class="token keyword">else</span> b
    <span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
    <span class="token keyword">return</span> b
x <span class="token operator">=</span> spam<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
x<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">)</span>
spam<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>在测试 None 值时，使用 is 操作符很重要，也是这种方案的关键点，有时候大家会犯下面的错误：</p>
<div class="code-chunk" data-id="code-chunk-id-126" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">spam</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token operator">not</span> b<span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># NO! use 'b is None' instead</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'b is None :'</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>
        b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'b is not None'</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
spam<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
spam<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>
spam<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
spam<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>应该修改为：</p>
<div class="code-chunk" data-id="code-chunk-id-127" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">spam</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> b <span class="token keyword">is</span> None<span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># NO! use 'b is None' instead</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'b is None :'</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>
        b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'b is not None'</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
spam<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
spam<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>
spam<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
spam<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>或者是：</p>
<div class="code-chunk" data-id="code-chunk-id-128" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">spam</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> b<span class="token operator">==</span>None<span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># NO! use 'b is None' instead</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'b is None :'</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>
        b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'b is not None'</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
spam<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
spam<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>
spam<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
spam<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>最后一个问题是一个函数需要测试某个可选参数是否被使用者传递进来。这时候需要小心的是，你不能用某个默认值比如 None、0 或者 False 值来测试用户提供的值（因为这些值都是合法的，是可能被用户传递进来的）。</p>
<p>为了解决这个问题，你可以创建一个独一无二的私有对象实例，就像之前的 <code>_no_value</code> 变量那样。在函数里面，你可以通过检查被传递参数值跟这个实例是否一样来判断。这里的思路是用户不可能去传递这个 _no_value 实例作为输入，因此这里通过检查这个值就能确定某个参数是否被传递进来了。</p>
<h3 class="mume-header" id="%E5%AE%9A%E4%B9%89%E5%8C%BF%E5%90%8D%E6%88%96%E5%86%85%E8%81%94%E5%87%BD%E6%95%B0">定义匿名或内联函数</h3>

<p>你想为 <code>sort()</code> 操作创建一个很短的回调函数，但有不想用 def 去写一个单行函数，而是希望通过某个快捷方式以内联方式来创建这个函数：</p>
<div class="code-chunk" data-id="code-chunk-id-129" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">add <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span>y<span class="token punctuation">:</span> x<span class="token operator">+</span>y
<span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>lambda 表达式典型的使用场景是排序或数据 reduce 等：</p>
<div class="code-chunk" data-id="code-chunk-id-130" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'David Beazley'</span><span class="token punctuation">,</span> <span class="token string">'Brain Jones'</span><span class="token punctuation">,</span>
    <span class="token string">'Raymond Hettinger'</span><span class="token punctuation">,</span> <span class="token string">'Ned Batchelder'</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sorted<span class="token punctuation">(</span>names<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> nm<span class="token punctuation">:</span> nm<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>尽管 lambda 表达式也许你定义简单函数，但是它的使用是有限制的。你只能指定单个表达式，它的值就是最后的返回值。也就是说不能包含其他的语言特性了，包括多个语句、条件表达式、迭代以及异常处理等等。</p>
<p>你可以不使用 lambda 表达式就能编写大部分python代码。但是，当有人编写大量计算表达式值得短小函数或者需要用户提供回调函数的程序时候，你就会看到 lambda 表达式的身影了。</p>
<h3 class="mume-header" id="%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0%E6%8D%95%E8%8E%B7%E5%8F%98%E9%87%8F%E5%80%BC">匿名函数捕获变量值</h3>

<p>你可以用 lambda 定义一个匿名函数，并且在定义时捕获到某些变量的值：</p>
<div class="code-chunk" data-id="code-chunk-id-131" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">x <span class="token operator">=</span> <span class="token number">10</span>
a <span class="token operator">=</span> <span class="token keyword">lambda</span> y<span class="token punctuation">:</span> x<span class="token operator">+</span>y
<span class="token keyword">def</span> <span class="token function">A</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> x<span class="token operator">+</span>y
x <span class="token operator">=</span> <span class="token number">20</span>
b <span class="token operator">=</span> <span class="token keyword">lambda</span> y<span class="token punctuation">:</span> x<span class="token operator">+</span>y
<span class="token keyword">def</span> <span class="token function">B</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> x<span class="token operator">+</span>y
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>A<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>B<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>在lambda表达式中，x是一个自由变量，在运行时绑定值，而不是定义时就绑定，<strong>这跟函数的默认值参数定义时不同的</strong>。因此，在调用这个lambda表达式的时候，x的值是执行时的值。</p>
<p>如果你想让某个匿名函数在定义时就捕获到值，可以将那个参数值定义成默认参数即可：</p>
<div class="code-chunk" data-id="code-chunk-id-132" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">x <span class="token operator">=</span> <span class="token number">10</span>
a <span class="token operator">=</span> <span class="token keyword">lambda</span> y<span class="token punctuation">,</span>x<span class="token operator">=</span>x<span class="token punctuation">:</span>x<span class="token operator">+</span>y
x <span class="token operator">=</span> <span class="token number">20</span>
b <span class="token operator">=</span> <span class="token keyword">lambda</span> y<span class="token punctuation">,</span>x<span class="token operator">=</span>x<span class="token punctuation">:</span>x<span class="token operator">+</span>y
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>这里列出来的问题是新手很容易犯的错误，有些新手可能会不恰当地使用 lambda 表达式，比如通过在一个循环或列表推导中创建一个 lambda 表达式列表，并期望函数在定义时就记住每次的迭代值，例如：</p>
<div class="code-chunk" data-id="code-chunk-id-133" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token comment" spellcheck="true"># Wrong code</span>
funcs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span>x<span class="token operator">+</span>n <span class="token keyword">for</span> n <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> f <span class="token keyword">in</span> funcs<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true"># Right code</span>
funcs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span>n<span class="token operator">=</span>n<span class="token punctuation">:</span>x<span class="token operator">+</span>n <span class="token keyword">for</span> n <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> f <span class="token keyword">in</span> funcs<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p><strong>通过使用函数默认值形式，lambda函数在定义时就能绑定到值。</strong></p>
<h3 class="mume-header" id="%E5%87%8F%E5%B0%91%E5%8F%AF%E5%88%B0%E7%94%A8%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%8F%82%E6%95%B0%E4%B8%AA%E6%95%B0">减少可到用对象的参数个数</h3>

<p>问题：你有一个其他 python 代码使用的 callable 对象，可能是一个回调函数或者是一个处理器，但是它的参数太多了，导致调用时出错。</p>
<p>解决方案：如果要减少某个函数的参数个数，你可以使用 <code>functools.partial()</code>。<code>partial()</code>函数允许你给一个或多个参数设置固定的值，减少接下来被调用时的参数个数。</p>
<div class="code-chunk" data-id="code-chunk-id-134" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">spam</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># 使用 functools.partial 函数来固定某些参数值</span>
<span class="token keyword">from</span> functools <span class="token keyword">import</span> partial
s1 <span class="token operator">=</span> partial<span class="token punctuation">(</span>spam<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># a=1</span>
s1<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>
s2 <span class="token operator">=</span> partial<span class="token punctuation">(</span>spam<span class="token punctuation">,</span> d<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
s2<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>c<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>b<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
s3 <span class="token operator">=</span> partial<span class="token punctuation">(</span>spam<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> d<span class="token operator">=</span><span class="token number">35</span><span class="token punctuation">)</span>
s3<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>可以看出 <code>partial()</code> 固定某些参数，并返回一个新的 callable 对象。这个新的 callable 接受未赋值的参数，然后跟之前赋值过的参数合并起来，最后所有参数传递给原始函数，其内部的工作机制为：</p>
<div class="code-chunk" data-id="code-chunk-id-135" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">mypartial</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token operator">**</span>kwargv<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token keyword">lambda</span> <span class="token operator">*</span>v<span class="token punctuation">,</span><span class="token operator">**</span>kwv<span class="token punctuation">:</span>f<span class="token punctuation">(</span><span class="token operator">*</span>argv<span class="token punctuation">,</span><span class="token operator">*</span>v<span class="token punctuation">,</span><span class="token operator">**</span>kwv<span class="token punctuation">,</span> <span class="token operator">**</span>kwargv<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">spam</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">)</span>

s1 <span class="token operator">=</span> mypartial<span class="token punctuation">(</span>spam<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># a=1</span>
s1<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>
s2 <span class="token operator">=</span> mypartial<span class="token punctuation">(</span>spam<span class="token punctuation">,</span> d<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
s2<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>c<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>b<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
s3 <span class="token operator">=</span> mypartial<span class="token punctuation">(</span>spam<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> d<span class="token operator">=</span><span class="token number">35</span><span class="token punctuation">)</span>
s3<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>本节要解决的问题是让原版不兼容的代码可以一起工作。<br>
例子1,假设你有一个点的列表来表示 (x, y)坐标元组。你可以用一下的函数来计算两点之间的距离：</p>
<div class="code-chunk" data-id="20180411135623" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd id=&amp;amp;quot;20180411135623&amp;amp;quot;}" class="language-python">points <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">import</span> math
<span class="token keyword">def</span> <span class="token function">distance</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><span class="token punctuation">:</span>
    x1<span class="token punctuation">,</span> y1 <span class="token operator">=</span> p1
    x2<span class="token punctuation">,</span> y2 <span class="token operator">=</span> p2
    <span class="token keyword">return</span> math<span class="token punctuation">.</span>hypot<span class="token punctuation">(</span>x1<span class="token operator">-</span>x2<span class="token punctuation">,</span> y1<span class="token operator">-</span>y2<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>现在假设你想以某个点为基点，根据点和基点之间的距离来排序所有的这些点，列表的 <code>sort</code> 接受一个关键字参数来自定义排序逻辑，但是它只能接受一个单个参数的函数(distance()很显然不符合该条件)。现在我们可以通过使用 <code>partial()</code>来解决这个问题：</p>
<div class="code-chunk" data-id="code-chunk-id-137" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd continue=&amp;amp;quot;20180411135623&amp;amp;quot;}" class="language-python">pt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">from</span> functools <span class="token keyword">import</span> partial
points<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span>partial<span class="token punctuation">(</span>distance<span class="token punctuation">,</span> pt<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span>
pt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
points<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> p<span class="token punctuation">:</span>distance<span class="token punctuation">(</span>p<span class="token punctuation">,</span> pt<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>更进一步，<code>partial()</code> 通常被用来微调其他库函数所使用的回调函数的参数。</p>
<p>很多时候，<code>partial()</code> 能实现的效果，lambda 表达式也能实现,不过相比而言会显得比较臃肿，对于代码阅读的人来说更加难懂。这时候使用 <code>partial()</code> 可以更加直观地表达你的意图（给某些参数预先赋值）。</p>
<h3 class="mume-header" id="%E5%B0%86%E5%8D%95%E6%96%B9%E6%B3%95%E7%9A%84%E7%B1%BB%E8%BD%AC%E6%8D%A2%E4%B8%BA%E5%87%BD%E6%95%B0">将单方法的类转换为函数</h3>

<p>问题：你有一个除 <code>__init__()</code> 方法外只定义了一个方法的类，为了简化代码，你想将它转换成一个函数。</p>
<p>解决方案：大多数情况下，可以使用闭包将单个方法的类转换成函数，例如下面示例的类用于计数：</p>
<div class="code-chunk" data-id="code-chunk-id-138" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">MyCounter</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> init<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>count <span class="token operator">=</span> init
    <span class="token keyword">def</span> <span class="token function">tick</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>count
ct1 <span class="token operator">=</span> MyCounter<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ct1<span class="token punctuation">.</span>tick<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ct1<span class="token punctuation">.</span>tick<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ct2 <span class="token operator">=</span> MyCounter<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ct1<span class="token punctuation">.</span>tick<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ct2<span class="token punctuation">.</span>tick<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ct2<span class="token punctuation">.</span>tick<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>这个类可以被一个更简单的函数来替代：</p>
<div class="code-chunk" data-id="code-chunk-id-139" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">get_counter</span><span class="token punctuation">(</span>init<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    closure_var <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'count'</span><span class="token punctuation">:</span>init<span class="token punctuation">}</span>
    <span class="token keyword">def</span> <span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        closure_var<span class="token punctuation">[</span><span class="token string">'count'</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">return</span> closure_var<span class="token punctuation">[</span><span class="token string">'count'</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> counter
ct1 <span class="token operator">=</span> get_counter<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ct1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ct1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ct2 <span class="token operator">=</span> get_counter<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ct1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ct2<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ct2<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>大部分情况下，你拥有一个单方法的原因是需要存储某些额外的状态来给方法使用。</p>
<p>使用一个内部函数或闭包的方法通常会更加优雅一些。简单来说，一个闭包就是一个函数，只不过在函数内部带上了一个额外的变量环境。闭包关键特点就是会记住自己被定义时的环境。因此，在我们解决方案中，<code>opener()</code>函数记住了 template 参数的值，并在接下来的调用中使用它。</p>
<p>任何时候，只要你碰到需要给某个函数增加额外的状态信息的问题，都可以考虑使用闭包。相比将你的函数转换成一个类而言，闭包通常是一种更加简洁和优雅的方案。</p>
<h3 class="mume-header" id="%E5%B8%A6%E9%A2%9D%E5%A4%96%E4%BF%A1%E6%81%AF%E7%9A%84%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0">带额外信息的回调函数</h3>

<p>问题：你的代码中依赖到回调函数的使用（比如时间处理器、等待后台任务完成后的回调等），并且你还需要然回调函数拥有额外的状态值，以便在它的内部使用到。</p>
<p>解决方案：这一小节主要讨论的是那些出现在很多函数库和框架中的回调函数的使用——特别是跟异步处理有关的。为了演示和测试，我们先定义如下一个需要调用回调函数的函数：</p>
<div class="code-chunk" data-id="20180411155159" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd id=&amp;amp;quot;20180411155159&amp;amp;quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">apply_async</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> args<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment" spellcheck="true"># compute the result</span>
    result <span class="token operator">=</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># invoke the callback with the result</span>
    callback<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> x<span class="token operator">+</span>y
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>实际上，这段代码可以做如何更高级的处理，包括线程、进程和定时器，但是这些都不是我们所要关心的。我们仅仅需要关注回调函数的调用。下面是一个演示如何使用上述代码的例子：</p>
<div class="code-chunk" data-id="code-chunk-id-141" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd continue=&amp;amp;quot;20180411155159&amp;amp;quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">print_result</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Got :'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>

apply_async<span class="token punctuation">(</span>add<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> callback<span class="token operator">=</span>print_result<span class="token punctuation">)</span>
apply_async<span class="token punctuation">(</span>add<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'hello '</span><span class="token punctuation">,</span> <span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> callback<span class="token operator">=</span>print_result<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>注意到 <code>print_result()</code> 函数仅仅接受一个参数 result。不能再传入其他信息，而当你想让回调函数访问其他变量或特定环境的变量值的时候就会遇到麻烦。</p>
<p>为了让回调函数访问外部信息，一种方法是使用一个绑定方法来替代一个简单函数。比如，下面这个类会保存一个内部序列号，每次接收到一个 result 的时候，序列号加 1：</p>
<div class="code-chunk" data-id="code-chunk-id-142" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd continue=&amp;amp;quot;20180411155159&amp;amp;quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">ResultHandler</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>sequence <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">def</span> <span class="token function">handler</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>sequence <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'[{self.sequence}] Got : {result}'</span><span class="token punctuation">)</span>

r1 <span class="token operator">=</span> ResultHandler<span class="token punctuation">(</span><span class="token punctuation">)</span>
apply_async<span class="token punctuation">(</span>add<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> callback<span class="token operator">=</span>r1<span class="token punctuation">.</span>handler<span class="token punctuation">)</span>
apply_async<span class="token punctuation">(</span>add<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'hello '</span><span class="token punctuation">,</span><span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> callback<span class="token operator">=</span>r1<span class="token punctuation">.</span>handler<span class="token punctuation">)</span>
r2 <span class="token operator">=</span> ResultHandler<span class="token punctuation">(</span><span class="token punctuation">)</span>
apply_async<span class="token punctuation">(</span>add<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> callback<span class="token operator">=</span>r2<span class="token punctuation">.</span>handler<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>第二种方式，作为类的替代，可以使用一个闭包捕获状态值：</p>
<div class="code-chunk" data-id="code-chunk-id-143" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd continue=&amp;amp;quot;20180411155159&amp;amp;quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">get_handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sequence <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">def</span> <span class="token function">handler</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">:</span>
        nonlocal sequence
        sequence <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'[{sequence}] Got : {result}'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> handler
h1 <span class="token operator">=</span> get_handler<span class="token punctuation">(</span><span class="token punctuation">)</span>
apply_async<span class="token punctuation">(</span>add<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> callback<span class="token operator">=</span>h1<span class="token punctuation">)</span>
apply_async<span class="token punctuation">(</span>add<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'hello '</span><span class="token punctuation">,</span><span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> callback<span class="token operator">=</span>h1<span class="token punctuation">)</span>
h2 <span class="token operator">=</span> get_handler<span class="token punctuation">(</span><span class="token punctuation">)</span>
apply_async<span class="token punctuation">(</span>add<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> callback<span class="token operator">=</span>h2<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>还有另外一种更加高级的方法，可以使用协程来完成同样的事情：</p>
<div class="code-chunk" data-id="code-chunk-id-144" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd continue=&amp;amp;quot;20180411155159&amp;amp;quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">make_handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sequence <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        result <span class="token operator">=</span> <span class="token keyword">yield</span>
        sequence <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'[{sequence}] Got : {result}'</span><span class="token punctuation">)</span>
handler <span class="token operator">=</span> make_handler<span class="token punctuation">(</span><span class="token punctuation">)</span>
next<span class="token punctuation">(</span>handler<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># Advance to the yield</span>
apply_async<span class="token punctuation">(</span>add<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> callback<span class="token operator">=</span>handler<span class="token punctuation">.</span>send<span class="token punctuation">)</span>
apply_async<span class="token punctuation">(</span>add<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'hello '</span><span class="token punctuation">,</span><span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> callback<span class="token operator">=</span>handler<span class="token punctuation">.</span>send<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>基于回调函数的软件通常都有可能变得非常复杂。一部分原因是回调函数通常会跟请求执行代码断开，因此，请求代码和处理结果之间的执行环境实际上已经丢失了。如果你想让回调函数连续执行多步操作，那你必须去解决如何保存和恢复相关的状态信息了。</p>
<p>至少有两种主要的方式来捕获和保存信息，你可以在一个对象实例（通过一个绑定方法）或者在一个闭包中保存它。两种方式比起来，闭包或许更加轻量级和自然一点，因为它们可以很简单地通过函数来构造。它们还能自动捕获所有被使用到的变量，因此，你无需去担心如何去存储额外的状态信息。</p>
<p>如果使用闭包，你需要注意那些可修改变量的操作。在上面的方案中，<code>nonlocal</code>声明语句用来指示接下来的变量会在回调函数中被修改。如果没有这个声明，代码会报错。</p>
<p>而使用一个协程来作为一个回调函数就更加有趣了。它跟闭包方法密切相关，某种意义上来讲，它显得更加简洁，因为总共就一个函数而已。并且，你可以很自由地修改变量而无需去使用 nonlocal 声明。这种方式的唯一缺点是相对于其他 Python 技术而言，或许比较难以理解。另外一个比较难懂的部分：比如使用之前需要调用 <code>next()</code>，实际上这个步骤很容易被忘记。尽管如此，协程还有其他方面的用处，比如作为一个内联回调函数的定义。</p>
<h3 class="mume-header" id="%E5%86%85%E8%81%94%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0-unfinished">内联回调函数 [unfinished]</h3>

<p>问题：当你编写使用回调函数的代码时，担心很多小函数的扩张可能会弄乱程序控制流，你希望找到某个方法来让代码看上去更像是一个普通的执行序列；</p>
<p>解决方案：通过生成器和协程可以使得回调函数内联在某个函数中，为了演示说明，假设你有如下所示的一个执行某种计算任务然后调用一个回调函数的函数：</p>
<div class="code-chunk" data-id="20180411163837" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd id=&amp;amp;quot;20180411163837&amp;amp;quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">apply_async</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> arg<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> func<span class="token punctuation">(</span><span class="token operator">*</span>arg<span class="token punctuation">)</span>
    callback<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>接下来让我们看一下下面的代码，它包含了一个 <code>Async</code> 类和一个 <code>inlined_async</code> 装饰器：</p>
<div class="code-chunk" data-id="code-chunk-id-146" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd continue=&amp;amp;quot;20180411163837&amp;amp;quot;}" class="language-python"><span class="token keyword">from</span> queue <span class="token keyword">import</span> Queue
<span class="token keyword">from</span> functools <span class="token keyword">import</span> wraps

<span class="token keyword">class</span> <span class="token class-name">Async</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> func<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>func <span class="token operator">=</span> func
        self<span class="token punctuation">.</span>args <span class="token operator">=</span> args

<span class="token keyword">def</span> <span class="token function">inlined_async</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    @wraps<span class="token punctuation">(</span>func<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="%E8%AE%BF%E9%97%AE%E9%97%AD%E5%8C%85%E4%B8%AD%E5%AE%9A%E4%B9%89%E7%9A%84%E5%8F%98%E9%87%8F">访问闭包中定义的变量</h3>

<p>问题：你想要扩展函数中的某个闭包，允许它能访问和修改函数的内部变量。</p>
<p>解决方案：通常来讲，闭包的内部变量对于外界来讲是完全隐藏的。但是，你可以通过编写访问函数，并将其作为函数属性绑定到闭包上来实现这个目的：</p>
<div class="code-chunk" data-id="code-chunk-id-147" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">sample</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment" spellcheck="true"># closure function</span>
    <span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'n ='</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># accessor method for n</span>
    <span class="token keyword">def</span> <span class="token function">get_n</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> n
    <span class="token keyword">def</span> <span class="token function">set_n</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        nonlocal n
        n <span class="token operator">=</span> value
    <span class="token comment" spellcheck="true"># attach as function attributes</span>
    func<span class="token punctuation">.</span>get_n <span class="token operator">=</span> get_n
    func<span class="token punctuation">.</span>set_n <span class="token operator">=</span> set_n
    <span class="token keyword">return</span> func

<span class="token comment" spellcheck="true"># usage</span>
f <span class="token operator">=</span> sample<span class="token punctuation">(</span><span class="token punctuation">)</span>
f<span class="token punctuation">(</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>set_n<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>get_n<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
f<span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>为了说明他如何工作，有两点需要解释一下。首先，<code>nonlocal</code>声明可以让我们编写函数来修改内部变量的值。其次，函数属性允许我们使用一种很简单的是将访问方法绑定到闭包函数上，这跟实例方法很像，尽管没有定义任何的类。</p>
<h2 class="mume-header" id="%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1">类与对象</h2>

<p>本章主要关注点是和类定义有关的常见编程模型，包括让对象支持常见的 Python 特性、特殊方法的使用、类封装技术、继承、内存管理以及有用的设计模式。</p>
<h3 class="mume-header" id="%E6%94%B9%E5%8F%98%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%98%BE%E7%A4%BA">改变对象的字符串显示</h3>

<p>问题：你想改变对象实例的打印或显示输出，让它们更具有可读性。</p>
<p>解决方案：要改变一个实例的字符串表示，可重新定义它的 <code>__str__()</code> 和 <code>__repr__()</code> 方法。例如：</p>
<div class="code-chunk" data-id="20180411211358" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd id=&amp;amp;quot;20180411211358&amp;amp;quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">Pair</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> x
        self<span class="token punctuation">.</span>y <span class="token operator">=</span> y
    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> f<span class="token string">'Pair({self.x!r}, {self.y!r})'</span>
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> f<span class="token string">'({self.x!s}, {self.y!s})'</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><pre data-role="codeBlock" data-info="python" class="language-python">p <span class="token operator">=</span> Pair<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> p <span class="token comment" spellcheck="true"># 输出 __repr__() 的返回</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 输出 __str__() 的返回</span>
p <span class="token operator">=</span> Pair<span class="token punctuation">(</span><span class="token string">'apple'</span><span class="token punctuation">,</span> <span class="token string">'banana'</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> p
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
</pre><pre data-role="codeBlock" data-info="" class="language-"><code>Pair(3, 4)
(3, 4)
Pair(&apos;apple&apos;, &apos;banana&apos;)
(apple, banana)
</code></pre><p>我们在这里还演示了在格式化的时候怎样使用不同的字符串表现形式。特别来讲，!r 格式化代码指明输出使用 <code>__repr__()</code> 来替代默认的 <code>__str__()</code> :</p>
<div class="code-chunk" data-id="code-chunk-id-149" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd continue=&amp;amp;quot;20180411211358&amp;amp;quot;}" class="language-python">p <span class="token operator">=</span> Pair<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'{p!r}'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'{p!s}'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'{p}'</span><span class="token punctuation">)</span>

s <span class="token operator">=</span> <span class="token string">'hello, world'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'{s!r}'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'{s}'</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">Pair(3, 4)
(3, 4)
(3, 4)
'hello, world'
hello, world
</pre></div></div><p>自定义 <code>__repr__()</code> 和 <code>__str__()</code> 通常是很好的习惯，因为它能简化调试和实例的输出。例如，如果仅仅是打印输出或者日志输出某个实例，那么程序员会看到实例更加详细与有用的信息。</p>
<p><code>__repr__()</code> 生成的文本字符串标准做法是需要让 <code>eval(repr(x))==x</code> 为真。如果实在做不到，应该创建一个有用的文本字符串，并使用 &lt; 和 &gt; 括起来，比如：</p>
<div class="code-chunk" data-id="code-chunk-id-150" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">f <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'test.py'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'{f!r}'</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text"><_io.TextIOWrapper name="test.py" mode="r" encoding="US-ASCII">
</_io.TextIOWrapper></pre></div></div><p>如果 <code>__str__()</code> 没有被定义，那么就会使用 <code>__repr__()</code> 来替代输出。</p>
<h3 class="mume-header" id="%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%A0%BC%E5%BC%8F%E5%8C%96">自定义字符串的格式化</h3>

<p>问题：你想通过 <code>format()</code> 函数和字符串方法使得一个对象能支持自定义的格式化。</p>
<p>解决方案：为了自定义字符串的格式化，我们需要在类上面定义 <code>__format__()</code> 方法。例如：</p>
<div class="code-chunk" data-id="code-chunk-id-151" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python">_formats <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'ymd'</span> <span class="token punctuation">:</span> <span class="token string">'{d.year}-{d.month}-{d.day}'</span><span class="token punctuation">,</span>
    <span class="token string">'mdy'</span> <span class="token punctuation">:</span> <span class="token string">'{d.month}/{d.day}/{d.year}'</span><span class="token punctuation">,</span>
    <span class="token string">'dmy'</span> <span class="token punctuation">:</span> <span class="token string">'{d.day}/{d.month}/{d.year}'</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Date</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> day<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>year <span class="token operator">=</span> year
        self<span class="token punctuation">.</span>month <span class="token operator">=</span> month
        self<span class="token punctuation">.</span>day <span class="token operator">=</span> day

    <span class="token keyword">def</span> <span class="token function">__format__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> code<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> code <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>
            code <span class="token operator">=</span> <span class="token string">'ymd'</span>
        fmt <span class="token operator">=</span> _formats<span class="token punctuation">[</span>code<span class="token punctuation">]</span>
        <span class="token keyword">return</span> fmt<span class="token punctuation">.</span>format<span class="token punctuation">(</span>d<span class="token operator">=</span>self<span class="token punctuation">)</span>
date <span class="token operator">=</span> Date<span class="token punctuation">(</span><span class="token number">2018</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'{date}'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">"Today is {date:mdy}"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>format<span class="token punctuation">(</span>date<span class="token punctuation">,</span> <span class="token string">'dmy'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">2018-4-11
Today is 4/11/2018
11/4/2018
</pre></div></div><p>讨论：<code>__format__()</code> 方法给 Python 字符串格式化功能提供了一个钩子。这里需要强调的是，格式化代码的解析工作完全由类自己决定。因此，格式化代码可以是任何值。例如参考下面来自 datetime 模块中的代码：</p>
<div class="code-chunk" data-id="code-chunk-id-152" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd}" class="language-python"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> date
d <span class="token operator">=</span> date<span class="token punctuation">(</span><span class="token number">2018</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>format<span class="token punctuation">(</span>d<span class="token punctuation">,</span> <span class="token string">'%A, %B %d %Y'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token string">'Today is {d:%a, %b %d %Y}'</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>▶︎</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">Wednesday, April 11 2018
Today is Wed, Apr 11 2018
</pre></div></div><p>对于内置类型的格式化，有一些标准的约定。可以参考 <code>string</code> 模块文档说明。</p>
<h3 class="mume-header" id="%E8%AE%A9%E5%AF%B9%E8%B1%A1%E6%94%AF%E6%8C%81%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE">让对象支持上下文管理协议</h3>

<p>问题：你想让你的对象支持上下文管理协议 （with 语句）。</p>
<p>解决方案：为了让一个对象兼容 with 语句，你需要实现一个 <code>__enter__()</code> 和 <code>__exit__()</code> 方法。</p>

      </div>
      <div class="md-sidebar-toc"><ul>
<li><a href="#python-%E4%BD%BF%E7%94%A8">Python 使用</a>
<ul>
<li><a href="#%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95">数据结构与算法</a>
<ul>
<li><a href="#%E5%8E%8B%E7%BC%A9%E5%BA%8F%E5%88%97%E7%9A%84%E8%B5%8B%E5%80%BC">压缩序列的赋值</a></li>
<li><a href="#collectionscounter">collections.Counter</a></li>
<li><a href="#%E9%80%9A%E8%BF%87%E6%9F%90%E4%B8%AA%E5%85%B3%E9%94%AE%E5%AD%97%E6%8E%92%E5%BA%8F%E5%AD%97%E5%85%B8%E5%88%97%E8%A1%A8">通过某个关键字排序字典列表</a></li>
<li><a href="#%E6%8E%92%E5%BA%8F%E6%AF%94%E6%94%AF%E6%8C%81%E5%8E%9F%E7%94%9F%E6%AF%94%E8%BE%83%E7%9A%84%E5%AF%B9%E8%B1%A1">排序比支持原生比较的对象</a></li>
<li><a href="#%E9%80%9A%E8%BF%87%E6%9F%90%E4%B8%AA%E5%AD%97%E6%AE%B5%E5%B0%86%E8%AE%B0%E5%BD%95%E5%88%86%E7%BB%84">通过某个字段将记录分组</a></li>
<li><a href="#%E8%BF%87%E6%BB%A4%E5%BA%8F%E5%88%97%E5%85%83%E7%B4%A0">过滤序列元素</a></li>
<li><a href="#%E5%AD%97%E5%85%B8%E7%9A%84%E6%9C%80%E5%A4%A7%E5%80%BC%E6%9C%80%E5%B0%8F%E5%80%BC%E6%8E%92%E5%BA%8F">字典的最大值/最小值/排序</a></li>
<li><a href="#%E4%BB%8E%E5%AD%97%E5%85%B8%E4%B8%AD%E6%8F%90%E5%8F%96%E5%AD%90%E9%9B%86">从字典中提取子集</a></li>
<li><a href="#%E5%AD%97%E5%85%B8%E5%90%88%E5%B9%B6">字典合并</a></li>
<li><a href="#%E6%98%A0%E5%B0%84%E5%90%8D%E7%A7%B0%E5%88%B0%E5%BA%8F%E5%88%97%E5%85%83%E7%B4%A0-namedtuple">映射名称到序列元素 namedtuple</a></li>
<li><a href="#%E8%BD%AC%E6%8D%A2%E5%B9%B6%E8%AE%A1%E7%AE%97%E6%95%B0%E6%8D%AE">转换并计算数据</a></li>
<li><a href="#%E5%88%A0%E9%99%A4%E5%BA%8F%E5%88%97%E7%B3%BB%E7%BB%9F%E5%85%83%E7%B4%A0%E5%B9%B6%E4%BF%9D%E6%8C%81%E9%A1%BA%E5%BA%8F">删除序列系统元素并保持顺序</a></li>
<li><a href="#%E5%91%BD%E5%90%8D%E5%88%87%E7%89%87">命名切片</a></li>
<li><a href="#defaultdict-%E6%A8%A1%E5%9D%97">defaultdict 模块</a>
<ul>
<li><a href="#%E4%BD%BF%E7%94%A8-dict%E5%AE%B9%E5%99%A8">使用 dict+容器</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8-collectionsdefaultdict">使用 collections.defaultdict</a></li>
<li><a href="#%E8%87%AA%E5%8A%A8%E5%88%9B%E5%BB%BA%E9%94%AE">自动创建键</a></li>
</ul>
</li>
<li><a href="#heapq-%E6%A8%A1%E5%9D%97">heapq 模块</a>
<ul>
<li><a href="#%E8%8E%B7%E5%BE%97%E9%9B%86%E5%90%88%E4%B8%AD%E6%9C%80%E5%A4%A7%E6%9C%80%E5%B0%8F%E7%9A%84n%E6%AD%8C%E5%85%83%E7%B4%A0%E5%88%97%E8%A1%A8">获得集合中最大/最小的N歌元素列表</a></li>
<li><a href="#%E5%A0%86%E6%8E%92%E5%BA%8F">堆排序</a></li>
<li><a href="#%E6%B3%A8%E6%84%8F">注意</a></li>
<li><a href="#%E6%8C%89%E4%BC%98%E5%85%88%E7%BA%A7%E6%8E%92%E5%BA%8F%E7%9A%84%E9%98%9F%E5%88%97">按优先级排序的队列</a></li>
</ul>
</li>
<li><a href="#collections-%E6%A8%A1%E5%9D%97">collections 模块</a>
<ul>
<li><a href="#deque">deque</a></li>
</ul>
</li>
<li><a href="#yield-%E7%9A%84%E4%BD%BF%E7%94%A8">yield 的使用</a>
<ul>
<li><a href="#%E5%8F%AF%E8%BF%AD%E4%BB%A3%E5%AF%B9%E8%B1%A1">可迭代对象</a></li>
<li><a href="#%E7%94%9F%E6%88%90%E5%99%A8">生成器</a></li>
<li><a href="#yield">yield</a></li>
</ul>
</li>
<li><a href="#%E4%B8%A2%E5%A4%B1%E7%9A%84%E4%B8%89%E5%85%83%E8%BF%90%E7%AE%97%E7%AC%A6">丢失的三元运算符 ?:</a></li>
<li><a href="#%E4%B8%A2%E5%A4%B1%E7%9A%84for%E8%AF%AD%E5%8F%A5">丢失的for语句</a></li>
<li><a href="#python%E7%9A%84%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2">Python的格式化字符串</a>
<ul>
<li><a href="#%E4%BD%BF%E7%94%A8%E6%93%8D%E4%BD%9C%E7%AC%A6">使用%操作符</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8stringformat">使用string.format</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8-f-%E5%AD%97%E7%AC%A6%E4%B8%B2">使用 f 字符串</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E5%86%85%E9%83%A8%E5%87%BD%E6%95%B0">内部函数</a></li>
<li><a href="#python%E7%9A%84%E7%B1%BB">Python的类</a>
<ul>
<li><a href="#python%E7%B1%BB%E4%B8%AD%E5%B1%9E%E6%80%A7%E6%96%B9%E6%B3%95%E5%91%BD%E5%90%8D">Python类中属性/方法命名</a>
<ul>
<li><a href="#%E4%BB%A5%E4%B8%80%E4%B8%AA%E4%B8%8B%E5%88%92%E7%BA%BF%E5%BC%80%E5%A4%B4-_foo">以一个下划线开头 _foo</a></li>
<li><a href="#%E4%BB%A5%E4%B8%80%E4%B8%AA%E4%B8%8B%E5%88%92%E7%BA%BF%E7%BB%93%E5%B0%BE-foo_">以一个下划线结尾 foo_</a></li>
<li><a href="#__foo__">__foo__</a></li>
<li><a href="#__foo">__foo</a></li>
</ul>
</li>
<li><a href="#%E7%B1%BB%E7%9A%84%E5%86%85%E7%BD%AE%E6%8E%A5%E5%8F%A3">类的内置接口</a>
<ul>
<li><a href="#__repr__">__repr__</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E8%8E%B7%E5%8F%96%E5%85%A8%E6%8E%92%E5%88%97">获取全排列</a></li>
<li><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%92%8C%E6%96%87%E6%9C%AC">字符串和文本</a>
<ul>
<li><a href="#%E4%BD%BF%E7%94%A8%E5%A4%9A%E4%B8%AA%E7%95%8C%E5%AE%9A%E7%AC%A6%E5%88%86%E5%89%B2%E5%AD%97%E7%AC%A6%E4%B8%B2">使用多个界定符分割字符串</a></li>
<li><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%BC%80%E5%A4%B4%E6%88%96%E7%BB%93%E5%B0%BE%E5%8C%B9%E9%85%8D">字符串开头或结尾匹配</a></li>
<li><a href="#%E7%94%A8-shell-%E9%80%9A%E9%85%8D%E7%AC%A6%E5%8C%B9%E9%85%8D%E5%AD%97%E7%AC%A6%E4%B8%B2">用 shell 通配符匹配字符串</a></li>
<li><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%B9%E9%85%8D%E5%92%8C%E6%90%9C%E7%B4%A2">字符串匹配和搜索</a></li>
<li><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%90%9C%E7%B4%A2%E5%92%8C%E6%9B%BF%E6%8D%A2">字符串搜索和替换</a></li>
<li><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%BF%BD%E7%95%A5%E5%A4%A7%E5%B0%8F%E5%86%99%E7%9A%84%E6%90%9C%E7%B4%A2%E6%9B%BF%E6%8D%A2">字符串忽略大小写的搜索替换</a></li>
<li><a href="#%E6%9C%80%E7%9F%AD%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%BC%8F">最短匹配模式</a></li>
<li><a href="#%E5%A4%9A%E8%A1%8C%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%BC%8F">多行匹配模式</a></li>
<li><a href="#%E5%88%A0%E9%99%A4%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E4%B8%8D%E9%9C%80%E8%A6%81%E7%9A%84%E5%AD%97%E7%AC%A6">删除字符串中不需要的字符</a></li>
<li><a href="#%E5%AE%A1%E6%9F%A5%E6%B8%85%E7%90%86%E6%96%87%E6%9C%AC%E6%95%B0%E6%8D%AE%E5%AD%97%E7%AC%A6%E4%B8%B2">审查清理文本数据字符串</a></li>
<li><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AF%B9%E9%BD%90">字符串对齐</a></li>
<li><a href="#%E5%90%88%E5%B9%B6%E6%8B%BC%E6%8E%A5%E5%AD%97%E7%AC%A6%E4%B8%B2">合并拼接字符串</a></li>
<li><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F%E6%9B%BF%E6%8D%A2">字符串中的变量替换</a></li>
<li><a href="#html-%E5%92%8C-xml-%E7%9A%84%E8%BD%AC%E6%8D%A2">html 和 xml 的转换</a></li>
<li><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BB%A4%E7%89%8C%E8%A7%A3%E6%9E%90">字符串令牌解析</a></li>
<li><a href="#%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E9%80%92%E5%BD%92%E4%B8%8B%E9%99%8D%E5%88%86%E6%9E%90%E5%99%A8">一个简单的递归下降分析器</a></li>
<li><a href="#%E5%AD%97%E8%8A%82%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8A%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C">字节字符串上的字符串操作</a></li>
</ul>
</li>
<li><a href="#%E6%95%B0%E5%AD%97%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4">数字日期和时间</a>
<ul>
<li><a href="#%E6%95%B0%E5%AD%97%E7%9A%84%E5%9B%9B%E8%88%8D%E4%BA%94%E5%85%A5">数字的四舍五入</a></li>
<li><a href="#%E6%89%A7%E8%A1%8C%E7%B2%BE%E7%A1%AE%E7%9A%84%E6%B5%AE%E7%82%B9%E6%95%B0%E8%BF%90%E7%AE%97">执行精确的浮点数运算</a></li>
<li><a href="#%E6%95%B0%E5%AD%97%E7%9A%84%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%BE%93%E5%87%BA">数字的格式化输出</a></li>
<li><a href="#%E4%BA%8C%E5%85%AB%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E8%A1%A8%E7%A4%BA%E6%95%B4%E6%95%B0">二八十六进制表示整数</a></li>
<li><a href="#%E5%AD%97%E8%8A%82%E5%88%B0%E5%A4%A7%E6%95%B4%E6%95%B0%E7%9A%84%E6%89%93%E5%8C%85%E4%B8%8E%E8%A7%A3%E5%8C%85">字节到大整数的打包与解包</a></li>
<li><a href="#%E5%A4%8D%E6%95%B0">复数</a></li>
<li><a href="#%E6%97%A0%E7%A9%B7%E5%A4%A7%E4%B8%8Enan">无穷大与NaN</a></li>
<li><a href="#%E5%88%86%E6%95%B0%E8%BF%90%E7%AE%97">分数运算</a></li>
<li><a href="#%E5%A4%A7%E5%9E%8B%E6%95%B0%E7%BB%84%E8%BF%90%E7%AE%97">大型数组运算</a></li>
<li><a href="#%E7%9F%A9%E9%98%B5%E4%B8%8E%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E8%BF%90%E7%AE%97">矩阵与线性代数运算</a></li>
<li><a href="#%E9%9A%8F%E6%9C%BA%E9%80%89%E6%8B%A9">随机选择</a></li>
<li><a href="#%E5%9F%BA%E6%9C%AC%E6%97%A5%E6%9C%9F%E4%B8%8E%E6%97%B6%E9%97%B4%E8%BD%AC%E6%8D%A2">基本日期与时间转换</a></li>
<li><a href="#%E8%AE%A1%E7%AE%97%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E5%91%A8%E4%BA%94%E7%9A%84%E6%97%A5%E6%9C%9F">计算最后一个周五的日期</a></li>
<li><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%8D%A2%E4%B8%BA%E6%97%B6%E9%97%B4">字符串转换为时间</a></li>
</ul>
</li>
<li><a href="#%E5%87%BD%E6%95%B0">函数</a>
<ul>
<li><a href="#%E5%8F%AF%E6%8E%A5%E5%8F%97%E4%BB%BB%E6%84%8F%E6%95%B0%E9%87%8F%E5%8F%82%E6%95%B0%E7%9A%84%E5%87%BD%E6%95%B0">可接受任意数量参数的函数</a></li>
<li><a href="#%E5%8F%AA%E6%8E%A5%E5%8F%97%E5%85%B3%E9%94%AE%E5%AD%97%E5%8F%82%E6%95%B0%E7%9A%84%E5%87%BD%E6%95%B0">只接受关键字参数的函数</a></li>
<li><a href="#%E7%BB%99%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E5%A2%9E%E5%8A%A0%E5%85%83%E4%BF%A1%E6%81%AF">给函数参数增加元信息</a></li>
<li><a href="#%E8%BF%94%E5%9B%9E%E5%A4%9A%E4%B8%AA%E5%80%BC%E7%9A%84%E5%87%BD%E6%95%B0">返回多个值的函数</a></li>
<li><a href="#%E5%AE%9A%E4%B9%89%E6%9C%89%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0%E7%9A%84%E5%87%BD%E6%95%B0">定义有默认参数的函数</a></li>
<li><a href="#%E5%AE%9A%E4%B9%89%E5%8C%BF%E5%90%8D%E6%88%96%E5%86%85%E8%81%94%E5%87%BD%E6%95%B0">定义匿名或内联函数</a></li>
<li><a href="#%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0%E6%8D%95%E8%8E%B7%E5%8F%98%E9%87%8F%E5%80%BC">匿名函数捕获变量值</a></li>
<li><a href="#%E5%87%8F%E5%B0%91%E5%8F%AF%E5%88%B0%E7%94%A8%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%8F%82%E6%95%B0%E4%B8%AA%E6%95%B0">减少可到用对象的参数个数</a></li>
<li><a href="#%E5%B0%86%E5%8D%95%E6%96%B9%E6%B3%95%E7%9A%84%E7%B1%BB%E8%BD%AC%E6%8D%A2%E4%B8%BA%E5%87%BD%E6%95%B0">将单方法的类转换为函数</a></li>
<li><a href="#%E5%B8%A6%E9%A2%9D%E5%A4%96%E4%BF%A1%E6%81%AF%E7%9A%84%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0">带额外信息的回调函数</a></li>
<li><a href="#%E5%86%85%E8%81%94%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0-unfinished">内联回调函数 [unfinished]</a></li>
<li><a href="#%E8%AE%BF%E9%97%AE%E9%97%AD%E5%8C%85%E4%B8%AD%E5%AE%9A%E4%B9%89%E7%9A%84%E5%8F%98%E9%87%8F">访问闭包中定义的变量</a></li>
</ul>
</li>
<li><a href="#%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1">类与对象</a>
<ul>
<li><a href="#%E6%94%B9%E5%8F%98%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%98%BE%E7%A4%BA">改变对象的字符串显示</a></li>
<li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%A0%BC%E5%BC%8F%E5%8C%96">自定义字符串的格式化</a></li>
<li><a href="#%E8%AE%A9%E5%AF%B9%E8%B1%A1%E6%94%AF%E6%8C%81%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE">让对象支持上下文管理协议</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
      <a id="sidebar-toc-btn">≡</a>
    </body>
    
    
    
    
    
    
    <script>
(function bindTaskListEvent() {
  var taskListItemCheckboxes = document.body.getElementsByClassName('task-list-item-checkbox')
  for (var i = 0; i < taskListItemCheckboxes.length; i++) {
    var checkbox = taskListItemCheckboxes[i]
    var li = checkbox.parentElement
    if (li.tagName !== 'LI') li = li.parentElement
    if (li.tagName === 'LI') {
      li.classList.add('task-list-item')
    }
  }
}())    
</script>
    
<script>

var sidebarTOCBtn = document.getElementById('sidebar-toc-btn')
sidebarTOCBtn.addEventListener('click', function(event) {
  event.stopPropagation()
  if (document.body.hasAttribute('html-show-sidebar-toc')) {
    document.body.removeAttribute('html-show-sidebar-toc')
  } else {
    document.body.setAttribute('html-show-sidebar-toc', true)
  }
})
</script>
      
  </html>